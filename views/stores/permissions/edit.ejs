<!-- ITEMS EDIT PAGE -->
<% include ../../partials/head/full %>
<section class="mb-2">
    <nav class="navbar navbar-expand navbar-light bg-nav">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores">Stores</a>
            </li>
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores/users">Users</a>
            </li>
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores/users/<%= user.user_id %>"><%= user.rank._rank %> <%= user._name %>, <%= user._ini %></a>
            </li>
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores/permissions/<%= user.user_id %>/edit">Edit Permissions</a>
            </li>
        </ul>
    </nav>
</section>
<section class="container-fluid p-5 row">
   <div class="details container bordered p-3 col-12 col-lg-9 col-xl-7">
        <form action="/stores/permissions/<%= user.user_id %>?_method=PUT" method="POST">
            <input type="hidden" name="failRedirect", value="/stores/users/<%= user.user_id %>" readonly>
            <input type="hidden" name="user[user_id]", value="<%= user.user_id %>" readonly>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Bader #:</label>
                </div> 
                <div class="col-7">
                    <input class="form-control" type="text" value="<%= user._bader %>">
                </div>
            </div>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Rank:</label>
                </div> 
                <div class="col-7">
                    <input class="form-control" type="text" value="<%= user.rank._rank %>">
                </div>
            </div>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Initials:</label>
                </div> 
                <div class="col-7">
                    <input class="form-control" type="text" value="<%= user._ini %>">
                </div>
            </div>
            <div class="row p-3">
                <button class="btn btn-primary btn-lg col-12" type="submit" id="_submit">Save</button>
                <a href="/stores/users/<%= user.user_id %>">Cancel</a>
            </div>
            <div>
                <p class="btn btn-sm btn-success w-100"><a href="javascript:p_disabled()">Disabled</a></p>
                <p class="btn btn-sm btn-success w-100"><a href="javascript:p_user()">User - Basic access and requests</a></p>
                <p class="btn btn-sm btn-success w-100"><a href="javascript:p_issuer()">Issuer - As User with issuing and returns</a></p>
                <p class="btn btn-sm btn-success w-100"><a href="javascript:p_storeman()">Storeman - As Issuer with stores related permissions</a></p>
                <p class="btn btn-sm btn-success w-100"><a href="javascript:p_admin()">Admin - As Storeman with settings and suppliers</a></p>
                <p class="btn btn-sm btn-success w-100"><a href="javascript:p_super()">Superuser - All permissions</a></p>
                <input class="form-control" type="text" id="inputSearch" onkeyup="searchTable('sizeTable', 'inputSearch')" placeholder="Search for permissions..">
                <table id="sizeTable" class="w-100">
                    <thead>
                        <th class="w-80">Permission</th>
                        <th class="w-20">Select</th>
                    </thead>
                    <tbody>
                        <% for (var permission in user.permission.dataValues) { %>
                            <% if (permission !== 'user_id' && permission !== 'createdAt' && permission !== 'updatedAt') { %>
                                <tr>
                                    <td>
                                        <label class="col-form-label" for="<%= permission %>"><%= permission %></label>
                                    </td>
                                    <td>
                                        <input class="form-control" id="<%= permission %>" type="checkbox" name="permissions[<%= permission %>]" value="1" <% if (user.permission[permission] === 1) {%> checked <% } %>>
                                    </td>
                                </tr>
                            <% } %>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </form>
    </div>
</section>
<% include ../../partials/foot/full %>
<script src="/js/tableSearch.js"></script>
<script>
    function p_disabled() {
        var permissions;
        permissions = [<%= permissions._options.attributes %>];
        permissions.forEach((permission) => {
            permission.checked = false;
        });
    };
    function p_user() {
        p_disabled();
        document.querySelector('#account_enabled').checked = true;
        document.querySelector('#access_requests').checked = true;
        document.querySelector('#requests_add').checked = true;
    };
    function p_issuer() {
        p_disabled();
        p_user();
        document.querySelector('#account_enabled').checked = true;
        document.querySelector('#access_issues').checked = true;
        document.querySelector('#access_items').checked = true;
        document.querySelector('#access_locations').checked = true;
        document.querySelector('#access_nsns').checked = true;
        document.querySelector('#issues_add').checked = true;
        document.querySelector('#issues_return').checked = true;
        document.querySelector('#access_notes').checked = true;
        document.querySelector('#notes_add').checked = true;
        document.querySelector('#requests_edit').checked = true;
        document.querySelector('#access_loancards').checked = true;
        document.querySelector('#access_print').checked = true;
        
    };
    function p_storeman() {
        p_disabled();
        p_user();
        p_issuer();
        document.querySelector('#item_add').checked = true;
        document.querySelector('#item_edit').checked = true;
        document.querySelector('#item_size_add').checked = true;
        document.querySelector('#locations_add').checked = true;
        document.querySelector('#locations_edit').checked = true;
        document.querySelector('#nsns_add').checked = true;
        document.querySelector('#nsns_edit').checked = true;
        document.querySelector('#item_receive').checked = true;
        document.querySelector('#item_count').checked = true;
        document.querySelector('#item_scrap').checked = true;
        document.querySelector('#item_stocktake').checked = true;
        document.querySelector('#requests_approve').checked = true;
        document.querySelector('#access_orders').checked = true;
        document.querySelector('#orders_add').checked = true;
        document.querySelector('#orders_place').checked = true;
        document.querySelector('#orders_edit').checked = true;
        document.querySelector('#access_demands').checked = true;
        document.querySelector('#demands_raise').checked = true;
        document.querySelector('#demands_search').checked = true;
        document.querySelector('#access_reports').checked = true;
    };
    function p_admin() {
        p_disabled();
        p_user();
        p_issuer();
        p_storeman();
        document.querySelector('#nsns_delete').checked = true;
        document.querySelector('#access_settings').checked = true;
        document.querySelector('#settings_edit').checked = true;
        document.querySelector('#settings_dropdown').checked = true;
        document.querySelector('#settings_dropdown_add').checked = true;
        document.querySelector('#settings_dropdown_edit').checked = true;
        document.querySelector('#settings_dropdown_delete').checked = true;
        document.querySelector('#item_size_delete').checked = true;
        document.querySelector('#nsns_delete').checked = true;
        document.querySelector('#locations_delete').checked = true;
        document.querySelector('#issues_edit').checked = true;
        document.querySelector('#access_users').checked = true;
        document.querySelector('#users_add').checked = true;
        document.querySelector('#users_edit').checked = true;
        document.querySelector('#users_permissions').checked = true;
        document.querySelector('#users_password').checked = true;
        document.querySelector('#users_status').checked = true;
        document.querySelector('#users_others').checked = true;
        document.querySelector('#notes_edit').checked = true;
        document.querySelector('#access_suppliers').checked = true;
        document.querySelector('#suppliers_add').checked = true;
        document.querySelector('#suppliers_edit').checked = true;
        document.querySelector('#suppliers_search').checked = true;
    };
    function p_super() {
        var permissions;
        permissions = [<%= permissions._options.attributes %>];
        permissions.forEach((permission) => {
            permission.checked = true;
        });
    };
</script>
<% include ../../partials/foot/htmlClose %>
