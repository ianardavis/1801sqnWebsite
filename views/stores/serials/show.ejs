<%- include(`${partials}/head/head`) %>
<body>
<%- include(`${partials}/head/flash`) %>
<section id='body'>
	<ul class="nav nav-tabs" id="mainTab" role="tablist">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Menu
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <% if (permissions.serial_edit) { %>
                    <%- include(`${partials}/edit`) %>
                <% } %>
                <div class="dropdown-divider"></div>
                <%- include(`${partials}/notes/menu_add`) %>
                <% if (permissions.serial_delete) { %>
                    <%- include(`${partials}/delete`, {close: true, onComplete: 'getSerials'}) %>
                <% } %>
            </div>
        </li>
        <%- include(`${partials}/tab_head`, {id: 'details', title: 'Details'}) %>
        <%- include(`${partials}/tab_head`, {id: 'notes',   title: 'Notes', count_id: 'note_count', permission: 'access_notes'}) %>
        <%- include(`${partials}/reload`) %>
    </ul>
    <div class="tab-content pt-3" id="myTabContent">
        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
            <%- include(`${partials}/spinner`, {id: 'serials'}) %>
            <%- include(`${partials}/inputs/display`, {id: '_serial',   title: 'Serial #'}) %>
            <%- include(`${partials}/inputs/display`, {id: '_location', title: 'Location'}) %>
        </div>
        <%- include(`${partials}/notes/tab_body`) %>
	</div>
<%- include(`${partials}/foot/noNav`) %>
<!-- get/spinner/XHRsend/send from notes include -->
<script src="/js/data/addFormListener.js"></script>
<script src='/js/tabs.js'></script>
<script src='/js/add.js'></script>
<script src='/js/edit.js'></script>
<script src="/js/stores/serials/show/serial.js"></script>
<script>showTab('<%= tab %>');</script>
<script>
    getSerial = () => {
        get(showSerial, {table: 'serials', query: [`serial_id=${path[3]}`]});
        window.opener.getSerials();
    };
    document.querySelector('#reload').addEventListener('click', () => getSerial());
</script>
<script async>getSerial()</script>
<%- include(`${partials}/foot/htmlClose`) %>
