<% include ../../partials/head/full %>
<section class="mb-2">
	<nav class="navbar navbar-expand navbar-light bg-nav">
		<ul class="navbar-nav mr-auto">
			<li class="nav-item">
				<a class="nav-link stores_nav" href="/stores">Stores</a>
			</li>
			<li class="nav-item">
				<a class="nav-link stores_nav" href="/stores/requests">Requests</a>
			</li>
		</ul>
	</nav>
</section>
<section>
	<nav class='navbar navbar-expand navbar-dark bg-dark stores'>
		<ul class='navbar-nav mr-auto'>
			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Options
				</a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdown">
					<!-- <div class="dropdown-divider"></div> -->
					<a class="dropdown-item" href="/stores">Back to Stores</a>
				</div>
			</li>
		</ul>
	</nav>
</section>
<section>
	<div class="container mt-3 pt-3">
		<form id="requests" action="/stores/requests/approve" method="POST">
			<div class="container mt-3 pt-3">
				<div>
					<div class="row">
						<label class="col-3 col-form-label text-right" for="cr">Completed Requests:</label>
						<select id="cr" class='form-control col-9' type="text" onchange=filterSelects()>
							<option value="1" <% if (query.cr === 1) { %>selected<% } %> >Include</option>
							<option value="2" <% if (query.cr === 2) { %>selected<% } %> >Exclude</option>
							<option value="3" <% if (query.cr === 3) { %>selected<% } %> >Only</option>
						</select>
					</div>
				</div>
			</div>
			<div>
				<table id="requestTable" class="table table-sm table-hover mx-auto w-100">
					<thead class="thead-dark">
						<th class="w-30" onclick="sortTable(0, 'requestTable')">For</th>
						<th class="w-30" onclick="sortTable(1, 'requestTable')">By</th>
						<th class="w-30" onclick="sortTable(2, 'requestTable')">Date</th>
						<th class="w-30" onclick="sortTable(3, 'requestTable')">Lines</th>
						<th class="w-10">Complete</th>
					</thead>
					<tbody>
						<% if (requests) { %>
							<% requests.forEach((request) => { %>
								<tr>
									<td><a href="/stores/requests/<%= request.request_id %>"><%= request.requestedFor.rank._rank %> <%= request.requestedFor._name %>, <%= request.requestedFor._ini %></a></td>
									<td><a href="/stores/requests/<%= request.request_id %>"><%= request.requestedBy.rank._rank %> <%= request.requestedBy._name %>, <%= request.requestedBy._ini %></a></td>
									<td data-sort="<%= request._date.getTime() %>"><a href="/stores/requests/<%= request.request_id %>"><%= request._date.toDateString() %></a></td>
									<td><a href="/stores/requests/<%= request.request_id %>"><%= request.lines.length %></a></td>
									<td><input class="form-control form-control-sm" type="checkbox" <% if (request._complete) { %>checked <% } %>disabled></td>
								</tr>
							<% }); %>
						<% }; %>
					</tbody>
				</table>
			</div>
		</form>
	</div>
</section>
<% include ../../partials/foot/full %>
<script src="/js/tableSort.js"></script>
<script src="/js/filters.js"></script>
<script>
	function filterSelects() {
        filter(['cr'], "/stores/requests");
	};
</script>
<% include ../../partials/foot/htmlClose %>