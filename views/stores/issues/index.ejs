<%- include(`${partials}/head/app`, {text: 'Stores'}) %>
<%- include(`${partials}/breadcrumb`, {text: 'Issues'}) %>
<%- include(`${partials}/menu/breadcrumb_add`, {modal: 'issue_add'}) %>
<%- include(`${partials}/reload`) %>
<%- include(`${partials}/spinner`, {id: 'issues'}) %>
<%- include(`${partials}/head/components/close`) %>
<section class="container">
	<div class="row">
		<div class="col-12 col-md-6">
			<button class="btn btn-primary w-100 mb-1" type="button" data-bs-toggle="collapse" data-bs-target="#col-filter" aria-expanded="false" aria-controls="col-filter">
				Filter
			</button>
		</div>
		<div class="col-12 col-md-6">
			<%- include(`${partials}/button/button`, {id: 'action_lines', type: 'success', text: 'Action Selected Issues', classes: ['w-100', 'mb-1'], form: 'issue_edit', disabled: true}) %>
		</div>
	</div>
	<div class="collapse mb-1" id="col-filter">
		<%- include(`${partials}/inputs/select`, {title: 'Filter By User', id: 'sel_users', spinner_id: 'users', reload_id: 'reload_users'}) %>
		<h5 class='text-start'>Status:</h5>
		<div class="row">
			<div class="col-6 col-sm-4">
				<%- include(`${partials}/inputs/checkbox`, {title: 'Cancelled', id: 'status_0', value: '0', colour: 'secondary', classes: ['status']}) %>
			</div>
			<div class="col-6 col-sm-4">
				<%- include(`${partials}/inputs/checkbox`, {title: 'Requested', id: 'status_1', value: '1', colour: 'warning', 	 classes: ['status'], checked: true}) %>
			</div>
			<div class="col-6 col-sm-4">
				<%- include(`${partials}/inputs/checkbox`, {title: 'Approved', 	id: 'status_2', value: '2', colour: 'success', 	 classes: ['status'], checked: true}) %>
			</div>
			<div class="col-6 col-sm-4">
				<%- include(`${partials}/inputs/checkbox`, {title: 'Ordered', 	id: 'status_3', value: '3', colour: 'primary',   classes: ['status'], checked: true}) %>
			</div>
			<div class="col-6 col-sm-4">
				<%- include(`${partials}/inputs/checkbox`, {title: 'Issued', 	id: 'status_4', value: '4', colour: 'info', 	 classes: ['status']}) %>
			</div>
			<div class="col-6 col-sm-4">
				<%- include(`${partials}/inputs/checkbox`, {title: 'Returned', 	id: 'status_5', value: '5', colour: 'secondary', classes: ['status']}) %>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-6">
				<h5 class='text-start'>Date From:</h5>
				<input type="date" class='form-control' id='createdAt_from'>
			</div>
			<div class="col-sm-6">
				<h5 class='text-start'>Date To:</h5>
				<input type="date" class='form-control' id='createdAt_to'>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-6">
				<h5 class='text-start'>Item:</h5>
				<input type="text" class='form-control' id='item'>
			</div>
			<div class="col-sm-6">
				<h5 class='text-start'>Size:</h5>
				<input type="text" class='form-control' id='size'>
			</div>
		</div>
	</div>
	<% if (permissions.issuer) { %>
		<form id='form_issue_edit'>
	<% } %>
		<table class="table table-sm table-hover">
			<thead class="thead-dark">
				<th class='w-15' onclick='sortByRow(this, getIssues)' data-sort_col='createdAt'	   >Date  <span class='sort_ind float-end'></span></th>
				<th class='w-20' onclick='sortByRow(this, getIssues)' data-sort_col='user_id_issue'>User  <span class='sort_ind float-end'></span></th>
				<th class='w-20'>Description</th>
				<th class='w-10' onclick='sortByRow(this, getIssues)' data-sort_col='size_id'  	   >Size  <span class='sort_ind float-end'></span></th>
				<th class='w-10' onclick='sortByRow(this, getIssues)' data-sort_col='qty'	   	   >Qty   <span class='sort_ind float-end'></span></th>
				<th class='w-10' onclick='sortByRow(this, getIssues)' data-sort_col='status'   	   >Status<span class='sort_ind float-end'></span></th>
				<th class='w-15'>Actions</th>
				<th><i class="fas fa-search"></i></th>
			</thead>
			<tbody id="tbl_issues"></tbody>
		</table>
		<nav class='float-start'>
			<ul class="pagination pagination-sm">
				<li class="page-item">
					<input class='btn-check' type="radio" id='offset_1',  name='radio_offset' autocomplete='off' value='1'>
					<label class="page-link btn btn-outline-primary" for="offset_1">1</label>
				</li>
				<li class="page-item">
					<input class='btn-check' type="radio" id='offset_2',  name='radio_offset' autocomplete='off' value='2'>
					<label class="page-link btn btn-outline-primary" for="offset_2">2</label>
				</li>
				<li class="page-item">
					<input class='btn-check' type="radio" id='offset_3',  name='radio_offset' autocomplete='off' value='3'>
					<label class="page-link btn btn-outline-primary" for="offset_3">3</label>
				</li>
			</ul>
		</nav>
		<nav class='float-end'>
			<ul class="pagination pagination-sm">
				<li class="page-item disabled"><p class="page-link">Issues per page:</p></li>
				<li class="page-item">
					<input class='btn-check' type="radio" id='limit_10',  name='radio_limit' autocomplete='off' value='10'>
					<label class="page-link btn btn-outline-primary" for="limit_10">10 </label>
				</li>
				<li class="page-item">
					<input class='btn-check' type="radio" id='limit_20',  name='radio_limit' autocomplete='off' value='20'>
					<label class="page-link btn btn-outline-primary" for="limit_20">20 </label>
				</li>
				<li class="page-item">
					<input class='btn-check' type="radio" id='limit_30',  name='radio_limit' autocomplete='off' value='30'>
					<label class="page-link btn btn-outline-primary" for="limit_30">30 </label>
				</li>
				<li class="page-item">
					<input class='btn-check' type="radio" id='limit_all', name='radio_limit' autocomplete='off'>
					<label class="page-link btn btn-outline-primary" for="limit_all">All</label>
				</li>
			</ul>
		</nav>
	<% if (permissions.issuer) { %></form><% } %>
	<div id="div_modals">
		<div class="modal fade" id="mdl_issue_add" tabindex="-1" aria-hidden="true">
			<div class="modal-dialog modal-xl">
				<form class="modal-content" id='form_issue_add'>
					<div class="modal-header">
						<h5 class="modal-title">Add Issue(s)</h5>
					</div>
					<div class="modal-body">
						<%- include(`${partials}/button/button`, {type: 'success', type_att: true, id: 'issue_users', text: 'Add User(s)', classes: ['w-100']}) %>
						<table class="table table-sm table-hover">
							<thead class="thead-dark">
								<th class="w-40" onclick="sortTable(0, 'tbl_issue_add')">Service #</th>
								<th class="w-60" onclick="sortTable(1, 'tbl_issue_add')">User</th>
								<th><i class="fas fa-trash-alt"></i></th>
							</thead>
							<tbody id="tbl_issue_users_add"></tbody>
						</table>
						<%- include(`${partials}/inputs/number`, {title: 'Quantity', value: '1', min: '1', id: 'issue_add_qty'}) %>
						<%- include(`${partials}/button/button`, {type: 'success', type_att: true, id: 'issue_sizes', text: 'Add Item(s)', classes: ['w-100']}) %>
						<table class="table table-sm table-hover">
							<thead class="thead-dark">
								<th class="w-40" onclick="sortTable(0, 'tbl_issue_add')">Item</th>
								<th class="w-40" onclick="sortTable(1, 'tbl_issue_add')">Size</th>
								<th class="w-20" onclick="sortTable(2, 'tbl_issue_add')">Quantity</th>
								<th><i class="fas fa-trash-alt"></i></th>
							</thead>
							<tbody id="tbl_issue_sizes_add"></tbody>
						</table>
					</div>
					<div class="modal-footer">
						<input type="submit" class="btn btn-success w-100" value='Add Issues'>
						<%- include(`${partials}/button/modal/close`) %>
					</div>
				</form>
			</div>
		</div>
	</div>
</section>
<%- include(`${partials}/foot/app`) %>
<script src='/js/utils/list/users.js'></script>
<script src='/js/search/select.js'></script>
<script src='/js/stores/issues/index/view.js'></script>
<script src='/js/stores/issues/index/add.js'></script>
<script src="/js/users/select/showWindow.js"></script>
<script src="/js/stores/sizes/select/showWindow.js"></script>
<% if (permissions.issuer) { %>
	<script src='/js/stores/issues/edit/issuer.js'></script>
	<% if (permissions.stores_stock_admin) { %>
		<script src='/js/stores/issues/edit/stock_admin.js'></script>
	<% } %>
<% } %>
<script async>getIssues()</script>
<script async>getUsers()</script>
<%- include(`${partials}/foot/components/htmlClose`) %>