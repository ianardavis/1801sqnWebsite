<%- include(`${partials}/head/app`) %>
<%- include(`${partials}/breadcrumb`, {href: '/stores',       text: 'Stores'}) %>
<%- include(`${partials}/breadcrumb`, {href: '/stores/items', text: 'Items'}) %>
<%- include(`${partials}/breadcrumb`, {id: '_item'}) %>
<%- include(`${partials}/breadcrumb`) %>
<%- include(`${partials}/reload`) %>
<%- include(`${partials}/head/navbar/close`) %>
<section class='container'>
    <ul class="nav nav-tabs" id="mainTab" role="tablist">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Menu
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
				<%- include(`${partials}/menu/button`, {id: 'size_edit',  text: 'Edit',               modal: 'size_edit'}) %>
                <div class="dropdown-divider"></div>
                <%- include(`${partials}/menu/button`, {id: 'note_add',   text: 'Add Note',           modal: 'note_add'}) %>
                <%- include(`${partials}/menu/button`, {id: 'nsn_add',    text: 'Add NSN',            modal: 'nsn_add',    classes: ['_nsns_element']}) %>
                <%- include(`${partials}/menu/button`, {id: 'serial_add', text: 'Add Serial #',       modal: 'serial_add', classes: ['_serials_element']}) %>
                <%- include(`${partials}/menu/button`, {id: 'stock_add',  text: 'Add Stock Location', modal: 'stock_add',  classes: ['_stock_element']}) %>
                <%- include(`${partials}/menu/button`, {id: 'order_add',  text: 'Add Order',          modal: 'order_add',  classes: ['_orderable_element']}) %>
				<% if (permissions.item_delete) { %><form id='form_delete'><% } %>
                <%- include(`${partials}/menu/button`, {id: 'delete',     text: 'Delete'}) %>
                <% if (permissions.item_delete) { %>
					</form>
					<script src="/js/stores/sizes/show/delete.js"></script>
				<% } %>
            </div>
        </li>
        <%- include(`${partials}/tab_head`, {id: 'details', title: 'Details', spinner: 'size'}) %>
        <%- include(`${partials}/tab_head`, {id: 'nsns',    title: 'NSNs',    spinner: 'nsns',    count_id: 'nsn',    permission: 'access_nsns',    _class: '_nsns_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'serials', title: 'Serials', spinner: 'serials', count_id: 'serial', permission: 'access_serials', _class: '_serials_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'stocks',  title: 'Stocks',  spinner: 'stocks',  count_id: 'stock',  permission: 'access_stocks',  _class: '_stock_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'orders',  title: 'Orders',  spinner: 'orders',  count_id: 'order',  permission: 'access_orders',  _class: '_orderable_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'issues',  title: 'Issues',  spinner: 'issues',  count_id: 'issue',  permission: 'access_issues',  _class: '_issueable_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'notes',   title: 'Notes',   spinner: 'notes',   count_id: 'note',   permission: 'access_notes'}) %>
    </ul>
    <div class="tab-content pt-3" id="myTabContent">
        <div     id="details" role="tabpanel" aria-labelledby="details-tab" class="tab-pane fade">
            <%- include(`${partials}/inputs/display`,  {id: '_issueable', title: 'Issueable'}) %>
            <%- include(`${partials}/inputs/display`,  {id: '_orderable', title: 'Orderable'}) %>
            <%- include(`${partials}/inputs/display`,  {id: '_serials',   title: 'Has Serials'}) %>
            <%- include(`${partials}/inputs/display`,  {id: '_nsns',      title: 'Has NSNs'}) %>
            <%- include(`${partials}/inputs/display`,  {id: 'supplier',   title: 'Supplier', link: true}) %>
            <div id="div_details">
                <hr>
                <% if (permissions.size_edit) { %>
                    <form id='form_detail_add' class="row">
                        <input type="hidden" id='size_id_detail' name='detail[size_id]'>
                        <div class="col-4">
                            <datalist id="list_detail_options"></datalist>
                            <input id='inp_detail_name'  class='form-control' type="text" name='detail[_name]'  placeholder='Name'  maxlength="45"   autocomplete="off" required list='list_detail_options'>
                        </div>
                        <div class="col-4">
                            <input id='inp_detail_value' class='form-control' type="text" name='detail[_value]' placeholder='Value' maxlength="1000" autocomplete="off" required>
                        </div>
                        <div class="col-4">
                            <button class='btn btn-success w-100'>Save</button>
                        </div>
                    </form>
                <% } %>
                <table class='table table-sm table-hover w-100'>
                    <thead class='thead-dark'>
                        <th class='w-20' onclick='sortTable(0, "tbl_details")'>Name</th>
                        <th class='w-80' onclick='sortTable(1, "tbl_details")'>Value</th>
                        <th><i class='fas fa-trash-alt'></i></th>
                    </thead>
                    <tbody id='tbl_details'></tbody>
                </table>
            </div>
        </div>
        <% if (permissions.access_nsns) { %>
            <div id="nsns"    role="tabpanel" aria-labelledby="nsns-tab"    class="tab-pane fade">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-80' onclick='sortTable(0, "tbl_nsns")'>NSN</th>
                        <th class='w-20'>Default</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_nsns'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_serials) { %>
            <div id="serials" role="tabpanel" aria-labelledby="serials-tab" class="tab-pane fade">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-50' onclick='sortTable(0, "tbl_serials")'>Serial #</th>
                        <th class='w-50' onclick='sortTable(1, "tbl_serials")'>Location</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_serials'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_stocks) { %>
            <div id="stocks"  role="tabpanel" aria-labelledby="stocks-tab"  class="tab-pane fade">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-80' onclick='sortTable(0, "tbl_stock")'>Location</th>
                        <th class='w-20' onclick='sortTable(1, "tbl_stock")'>Qty</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_stock'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_orders) { %>
            <div id="orders"  role="tabpanel" aria-labelledby="orders-tab"  class="tab-pane fade">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-50' onclick='sortTable(0, "tbl_orders")'>Date</th>
                        <th class='w-10' onclick='sortTable(1, "tbl_orders")'>Qty</th>
                        <th class='w-40' onclick='sortTable(2, "tbl_orders")'>Status</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_orders'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_issues) { %>
            <div id="issues"  role="tabpanel" aria-labelledby="issues-tab"  class="tab-pane fade">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-20' onclick='sortTable(0, "tbl_issues")'>Date</th>
                        <th class='w-40' onclick='sortTable(1, "tbl_issues")'>To</th>
                        <th class='w-10' onclick='sortTable(2, "tbl_issues")'>Qty</th>
                        <th class='w-30' onclick='sortTable(2, "tbl_orders")'>Status</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_issues'></tbody>
                </table>
            </div>
        <% } %>
        <%- include(`${partials}/notes/tab_body`) %>
    </div>
    <div id="div_modals">
        <% if (permissions.serial_add || permissions.stock_add) { %>
            <datalist id="locations_list"></datalist>
            <script src="/js/stores/locations/getLocations.js"></script>
        <% } %>
        <% if (permissions.size_edit) { %>
            <div     id='mdl_size_edit'   class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <form class="modal-content" id='form_size_edit'>
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Size</h5>
                        </div>
                        <div class="modal-body">
                            <%- include(`${partials}/inputs/select_yes_no`, {name: 'size[_issueable]',        title: 'Issueable',        id: '_issueable_edit'}) %>
                            <%- include(`${partials}/inputs/select_yes_no`, {name: 'size[_orderable]',        title: 'Orderable',        id: '_orderable_edit'}) %>
                            <%- include(`${partials}/inputs/select_yes_no`, {name: 'size[_serials]',          title: 'Has Serial #',     id: '_serials_edit'}) %>
                            <%- include(`${partials}/inputs/select_yes_no`, {name: 'size[_nsns]',             title: 'Has NSNs',         id: '_nsns_edit'}) %>
                            <%- include(`${partials}/inputs/select`,        {name: 'size[supplier_id]',       title: 'Supplier',         id: 'supplier_id_edit', spinner_id: 'suppliers', reload_id: 'reload_suppliers'}) %>
                            <%- include(`${partials}/inputs/text`,          {name: 'size[_size]',             title: 'Size',             id:'_size_edit',        maxlength: 15, placeholder: 'Required', required: true}) %>
                        </div>
                        <div class="modal-footer">
                            <input type="submit" class="btn btn-success w-100" value='Save Size'>
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        <% } %>
        <% if (permissions.order_add) { %>
            <div     id='mdl_order_add'   class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <form class="modal-content" id='form_order_add'>
                        <div class="modal-header">
                            <h5 class="modal-title">Order Item</h5>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name='line[size_id]' class='size_id'>
                            <%- include(`${partials}/inputs/number`, {name: 'line[_qty]', title: 'Quantity', value: '1', maxlength: 8, placeholder: 'Required', required: true}) %>
                        </div>
                        <div class="modal-footer">
                            <input type="submit" class="btn btn-success w-100" value='Save Order'>
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
            <script src="/js/stores/sizes/show/orders/add.js"></script>
        <% } %>
        <% if (permissions.access_nsns) { %>
            <div     id='mdl_nsn_view'    class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5   class="modal-title">NSN ID: <span id="nsn_id"></span> | <span id="_nsn_view"></span></h5>
                            <span class='float-right' id='nsn_buttons'>
                                <a class='btn btn-primary' id='btn_nsn_link'><i class="fas fa-search"></i></a>
                            </span>
                        </div>
                        <div class="modal-body">
                            <%- include(`${partials}/inputs/display`, {id: 'nsn_group_id',          classes: ['text-left'], title: 'Group'}) %>
                            <%- include(`${partials}/inputs/display`, {id: 'nsn_class_id', classes: ['text-left'], title: 'Classification'}) %>
                            <%- include(`${partials}/inputs/display`, {id: 'nsn_country_id',        classes: ['text-left'], title: 'Country'}) %>
                            <%- include(`${partials}/inputs/display`, {id: '_item_number',          classes: ['text-left'], title: 'Item Number'}) %>
                            <%- include(`${partials}/inputs/display`, {id: '_default',              classes: ['text-left'], title: 'Is Default?'}) %>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <% if (permissions.nsn_add) { %>
                <div id='mdl_nsn_add'     class="modal fade" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-lg" role="document">
                        <form class="modal-content" id='form_nsn_add'>
                            <div class="modal-header">
                                <h5 class="modal-title">Add NSN</h5>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" class='size_id' name='nsn[size_id]'>
                                <%- include(`${partials}/inputs/select`, {title: 'Group',          name: 'nsn[nsn_group_id]',          placeholder: 'Required', required: true, id: 'nsn_group_id_add'}) %>
                                <%- include(`${partials}/inputs/select`, {title: 'Classification', name: 'nsn[nsn_class_id]', placeholder: 'Required', required: true, id: 'nsn_class_id_add'}) %>
                                <%- include(`${partials}/inputs/select`, {title: 'Country',        name: 'nsn[nsn_country_id]',        placeholder: 'Required', required: true, id: 'nsn_country_id_add'}) %>
                                <%- include(`${partials}/inputs/text`,   {title: 'Item Number',    name: 'nsn[_item_number]',          placeholder: 'Required', required: true, inputmode: 'numeric', maxLength: '8'}) %>
                                <%- include(`${partials}/inputs/select`, {title: 'Default?',       name: 'default', options: [{text: 'Yes', value: '1'}, {text: 'No', value: '0', selected: true}]}) %>
                            </div>
                            <div class="modal-footer">
                                <input type="submit" class="btn btn-success w-100" value='Save NSN'>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
                <script src="/js/stores/sizes/show/nsns/add.js"></script>
            <% } %>
        <% } %>
        <% if (permissions.access_serials) { %>
            <div     id='mdl_serial_view' class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5   class="modal-title">Serial ID: <span id="serial_id"></span> | <span id="_serial_view"></span></h5>
                            <span class='float-right' id='serial_buttons'>
                                <a class='btn btn-primary' id='btn_serial_link'><i class="fas fa-search"></i></a>
                            </span>
                        </div>
                        <div class="modal-body">
                            <%- include(`${partials}/inputs/display`, {id: 'serial_location', classes: ['text-left'], title: 'Location'}) %>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <% if (permissions.serial_add) { %>
                <div id='mdl_serial_add'  class="modal fade" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-lg" role="document">
                        <form class="modal-content" id='form_serial_add'>
                            <div class="modal-header">
                                <h5 class="modal-title">Add Serial</h5>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" class='size_id' name='serial[size_id]'>
                                <%- include(`${partials}/inputs/text`, {title: 'Serial #', id: '_serial',          name: 'serial[_serial]', maxlength: 45, required: true}) %>
                                <%- include(`${partials}/inputs/text`, {title: 'Location', id: 'serial_locations', name: '_location',       maxlength: 20, required: true, list: true, spinner: true, spinner_id: 'locations'}) %>
                            </div>
                            <div class="modal-footer">
                                <input  type="submit" class="btn btn-success w-100" value='Save Size'>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
                <script src="/js/stores/sizes/show/serials/add.js"></script>
            <% } %>
        <% } %>
        <% if (permissions.access_stocks) { %>
            <div     id='mdl_stock_view'  class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="_stock_view">Stock ID: <span id="stock_id"></span></h5>
                            <span class='float-right' id='stock_buttons'>
                                <a class='btn btn-primary' id='btn_stock_link'><i class="fas fa-search"></i></a>
                            </span>
                        </div>
                        <div class="modal-body">
                            <ul class="nav nav-tabs" id="stockTab" role="tablist">
                                <%- include(`${partials}/tab_head`, {id: 'stock-view',    title: 'Stock',       spinner: 'stock_view',    active: true}) %>
                                <%- include(`${partials}/tab_head`, {id: 'stock-adjusts', title: 'Adjustments', spinner: 'stock_adjusts', count_id: 'stock_adjusts', permission: 'access_adjusts'}) %>
                            </ul>
                            <div class="tab-content pt-3" id="stockContent">
                                <div class="tab-pane fade show active" id="stock-view" role="tabpanel" aria-labelledby="stock-view-tab">
                                    <%- include(`${partials}/inputs/display`, {id: 'stock_location', classes: ['text-left'], title: 'Location'}) %>
                                    <%- include(`${partials}/inputs/display`, {id: '_qty',           classes: ['text-left'], title: 'Quantity'}) %>
                                </div>
                                <% if (permissions.access_adjusts) { %>
                                    <div class="tab-pane fade" id="stock-adjusts" role="tabpanel" aria-labelledby="stock-adjusts-tab">
                                        <% if (permissions.adjust_add) { %>
                                            <form class='row' id='form_adjust_add'>
                                                <input type="hidden" name='adjust[stock_id]' id='stock_id_adjust'>
                                                <div class="col-4">
                                                    <select class='form-control' name='adjust[_type]' required>
                                                        <option value="Count">Count</option>
                                                        <option value="Scrap">Scrap</option>
                                                    </select>
                                                </div>
                                                <div class="col-4">
                                                    <input id='stock_id_qty' class='form-control' type="number" inputmode="numeric" min='0' maxlength="11" name='adjust[_qty]' required>
                                                </div>
                                                <div class="col-4">
                                                    <button class='btn btn-success w-100'>Save</button>
                                                </div>
                                            </form>
                                            <script src="/js/stores/sizes/show/stock/adjusts/add.js"></script>
                                        <% } %>
                                        <table class='table table-sm table-hover'>
                                            <thead class='thead-dark'>
                                                <th class='w-30' onclick='sortTable(0, "tbl_adjusts")'>Date</th>
                                                <th class='w-30' onclick='sortTable(1, "tbl_adjusts")'>Type</th>
                                                <th class='w-20' onclick='sortTable(2, "tbl_adjusts")'>Qty</th>
                                                <th class='w-20' onclick='sortTable(3, "tbl_adjusts")'>Variance</th>
                                            </thead>
                                            <tbody id='tbl_adjusts'></tbody>
                                        </table>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <% if (permissions.stock_add) { %>
                <div id='mdl_stock_add'   class="modal fade" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-lg" role="document">
                        <form class="modal-content" id='form_stock_add'>
                            <div class="modal-header">
                                <h5 class="modal-title">Add Serial</h5>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" class='size_id' name='stock[size_id]'>
                                <%- include(`${partials}/inputs/text`, {title: 'Location', id: 'stock_locations', name: '_location', maxlength: 20, required: true, list_id: 'locations_list', spinner: true, spinner_id: 'locations'}) %>
                            </div>
                            <div class="modal-footer">
                                <input  type="submit" class="btn btn-success w-100" value='Save Location'>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
                <script src="/js/stores/sizes/show/stock/add.js"></script>
            <% } %>
        <% } %>
    </div>
</section>
<%- include(`${partials}/foot/app`) %>
<script src="/js/addFormListener.js"></script>
<script src='/js/tabs.js'></script>
<script>showTab('<%= tab %>');</script>
<script src="/js/stores/sizes/show/view.js"></script>
<script async>getSize()</script>
<script async>getDetails()</script>
<% if (permissions.access_nsns) { %>
    <script src="/js/stores/sizes/show/nsns/view.js"></script>
    <script async>getNSNs()</script>
<% } %>
<% if (permissions.access_serials) { %>
    <script src="/js/stores/sizes/show/serials/view.js"></script>
    <script async>getSerials()</script>
<% } %>
<% if (permissions.access_stocks) { %>
    <script src="/js/stores/sizes/show/stock/view.js"></script>
    <script async>getStocks()</script>
    <% if (permissions.access_adjusts) { %>
        <script src="/js/stores/sizes/show/stock/adjusts/view.js"></script>
    <% } %>
<% } %>
<% if (permissions.access_orders) { %>
    <script src="/js/stores/sizes/show/orders/view.js"></script>
    <script async>getOrders()</script>
<% } %>
<% if (permissions.access_issues) { %>
    <script src="/js/stores/sizes/show/issues/view.js"></script>
    <script async>getIssues()</script>
<% } %>
<% if (permissions.size_edit) { %>
    <script src="/js/utils/list/suppliers.js"></script>
    <script src="/js/stores/sizes/show/edit.js"></script>
    <script async>getSizeEdit()</script>
    <script>loadDetailDelete()</script>
<% } %>
<%- include(`${partials}/foot/elements/htmlClose`) %>