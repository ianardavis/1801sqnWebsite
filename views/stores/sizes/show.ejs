<%- include(`${partials}/head/full`) %>
<section class='mb-2'>
    <nav class='navbar navbar-expand navbar-light bg-nav'>
        <ul class='navbar-nav mr-auto'>
            <%- include(`${partials}/breadcrumb`, {href: '/stores',       text: 'Stores'}) %>
            <%- include(`${partials}/breadcrumb`, {href: '/stores/items', text: 'Items'}) %>
            <%- include(`${partials}/breadcrumb`, {id: '_item'}) %>
            <%- include(`${partials}/breadcrumb`) %>
            <%- include(`${partials}/reload`) %>
    </ul>
    </nav>
</section>
<section class='container'>
    <ul class="nav nav-tabs" id="mainTab" role="tablist">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Menu
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <% if (permissions.size_edit) { %>
                    <%- include(`${partials}/menu/edit`) %>
                <% } %>
                <div class="dropdown-divider"></div>
                <%- include(`${partials}/notes/menu_add`) %>
                <% if (permissions.nsn_add) { %> 
                    <a class='dropdown-item'                  data-toggle="modal" data-target="#mdl_nsn_add"   >Add NSN</a> 
                <% } %>
                <% if (permissions.serial_add) { %> 
                    <a class='dropdown-item _serials_element' data-toggle="modal" data-target="#mdl_serial_add">Add Serial</a> 
                <% } %>
                <% if (permissions.stock_add) { %>
                    <a class='dropdown-item _stock_element'   data-toggle="modal" data-target="#mdl_stock_add" >Add Stock Location</a>
                <% } %>
                <% if (permissions.order_add) { %>
                    <a class='dropdown-item' id='add_order'>Add Order</a>
                <% } %>
                <% if (permissions.size_delete) { %>
                    <%- include(`${partials}/menu/delete`, {redirect: '/stores/items'}) %>
                <% } %>
            </div>
        </li>
        <%- include(`${partials}/tab_head`, {id: 'details',  title: 'Details',                       spinner: 'size'}) %>
        <%- include(`${partials}/tab_head`, {id: 'nsns',     title: 'NSNs',     count_id: 'nsn',     spinner: 'nsns',          permission: 'access_nsns',          _class: '_nsns_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'serials',  title: 'Serials',  count_id: 'serial',  spinner: 'serials',       permission: 'access_serials',       _class: '_serials_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'stock',    title: 'Stock',    count_id: 'stock',   spinner: 'stock',         permission: 'access_stock',         _class: '_stock_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'requests', title: 'Requests', count_id: 'request', spinner: 'request_lines', permission: 'access_request_lines', _class: '_issueable_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'orders',   title: 'Orders',   count_id: 'order',   spinner: 'order_lines',   permission: 'access_order_lines',   _class: '_orderable_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'receipts', title: 'Receipts', count_id: 'receipt', spinner: 'receipt_lines', permission: 'access_receipt_lines', _class: '_orderable_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'issues',   title: 'Issues',   count_id: 'issue',   spinner: 'issue_lines',   permission: 'access_issue_lines',   _class: '_issueable_element'}) %>
        <%- include(`${partials}/tab_head`, {id: 'notes',    title: 'Notes',    count_id: 'note',    spinner: 'notes',         permission: 'access_notes'}) %>
    </ul>
    <div class="tab-content pt-3" id="myTabContent">
        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
            <%- include(`${partials}/inputs/display`,  {id: '_issueable',        title: 'Issueable'}) %>
            <%- include(`${partials}/inputs/display`,  {id: '_orderable',        title: 'Orderable'}) %>
            <%- include(`${partials}/inputs/display`,  {id: '_serials',          title: 'Has Serials'}) %>
            <%- include(`${partials}/inputs/display`,  {id: '_nsns',             title: 'Has NSNs'}) %>
            <%- include(`${partials}/inputs/display`,  {id: 'supplier',          title: 'Supplier', append: {a: {id: 'supplier_link', type: 'primary', text: '<i class="fas fa-search"></i>'}}}) %>
            <%- include(`${partials}/inputs/display`,  {id: '_demand_page',      title: 'Demand Page'}) %>
            <%- include(`${partials}/inputs/display`,  {id: '_demand_cell',      title: 'Demand Cell'}) %>
            <%- include(`${partials}/inputs/textarea`, {id: '_ordering_details', title: 'Ordering Details', rows: 5, readonly: true}) %>
        </div>
        <% if (permissions.access_nsns) { %>
            <div class="tab-pane fade" id="nsns" role="tabpanel" aria-labelledby="nsns-tab">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-80' onclick='sortTable(0, "tbl_nsns")'>NSN</th>
                        <th class='w-20'>Default</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_nsns'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_serials) { %>
            <div class="tab-pane fade serial_element" id="serials" role="tabpanel" aria-labelledby="serials-tab">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-50' onclick='sortTable(0, "tbl_serials")' >Serial #</th>
                        <th class='w-50' onclick='sortTable(1, "tbl_serials")'>Location</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_serials'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_stock) { %>
            <div class="tab-pane fade" id="stock" role="tabpanel" aria-labelledby="stock-tab">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-80' onclick='sortTable(0, "tbl_stock")'>Location</th>
                        <th class='w-20' onclick='sortTable(1, "tbl_stock")'>Qty</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_stock'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_request_lines) { %>
            <div class="tab-pane fade" id="requests" role="tabpanel" aria-labelledby="requests-tab">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-80' onclick='sortTable(0, "tbl_requests")'>For</th>
                        <th class='w-20' onclick='sortTable(1, "tbl_requests")'>Qty</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_requests'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_order_lines) { %>
            <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-80' onclick='sortTable(0, "tbl_orders")'>For</th>
                        <th class='w-20' onclick='sortTable(1, "tbl_orders")'>Qty</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_orders'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_receipt_lines) { %>
            <div class="tab-pane fade" id="receipts" role="tabpanel" aria-labelledby="receipts-tab">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-80' onclick='sortTable(0, "tbl_receipts")'>Date</th>
                        <th class='w-20' onclick='sortTable(1, "tbl_receipts")'>Location</th>
                        <th class='w-20' onclick='sortTable(2, "tbl_receipts")'>Qty</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_receipts'></tbody>
                </table>
            </div>
        <% } %>
        <% if (permissions.access_issue_lines) { %>
            <div class="tab-pane fade" id="issues" role="tabpanel" aria-labelledby="issues-tab">
                <table class='table table-sm table-hover'>
                    <thead class='thead-dark'>
                        <th class='w-20' onclick='sortTable(0, "tbl_issues")'>Date</th>
                        <th class='w-60' onclick='sortTable(1, "tbl_issues")'>To</th>
                        <th class='w-20' onclick='sortTable(2, "tbl_issues")'>Qty</th>
                        <th><i class='fas fa-search'></i></th>
                    </thead>
                    <tbody id='tbl_issues'></tbody>
                </table>
            </div>
        <% } %>
        <%- include(`${partials}/notes/tab_body`) %>
    </div>
    <div id="div_modals">
        <% if (permissions.nsn_add || permissions.nsn_edit || permissions.serial_add || permissions.serial_edit || permissions.stock_add || permissions.stock_edit) { %>
            <datalist id="locations_list"></datalist>
        <% } %>
        <% if (permissions.size_edit) { %>
            <div     id='mdl_edit_size'   class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <form class="modal-content" id='form_edit_size'>
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Size</h5>
                        </div>
                        <div class="modal-body">
                            <%- include(`${partials}/inputs/select_yes_no`, {name: 'size[_issueable]',        title: 'Issueable',        id: '_issueable_edit'}) %>
                            <%- include(`${partials}/inputs/select_yes_no`, {name: 'size[_orderable]',        title: 'Orderable',        id: '_orderable_edit'}) %>
                            <%- include(`${partials}/inputs/select_yes_no`, {name: 'size[_serials]',          title: 'Has Serial #',     id: '_serials_edit'}) %>
                            <%- include(`${partials}/inputs/select_yes_no`, {name: 'size[_nsns]',             title: 'Has NSNs',         id: '_nsns_edit'}) %>
                            <%- include(`${partials}/inputs/select`,        {name: 'size[supplier_id]',       title: 'Supplier',         id: 'supplier_id_edit',       spinner: true, spinner_id: 'suppliers'}) %>
                            <%- include(`${partials}/inputs/text`,          {name: 'size[_demand_page]',      title: 'Demand Page',      id: '_demand_page_edit',      maxlength: 20}) %>
                            <%- include(`${partials}/inputs/text`,          {name: 'size[_demand_cell]',      title: 'Cell',             id: '_demand_cell_edit',      maxlength: 3}) %>
                            <%- include(`${partials}/inputs/textarea`,      {name: 'size[_ordering_details]', title: 'Ordering Details', id: '_ordering_details_edit', maxlength: 1000, rows: 5}) %>
                            <%- include(`${partials}/inputs/text`,          {name: 'size[_size]',             title: 'Size',             id:'_size_edit',              maxlength: 15,   placeholder: 'Required', required: true}) %>
                        </div>
                        <div class="modal-footer">
                            <input type="submit" class="btn btn-success w-100 confirm" value='Save Size'>
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                </div>
            </div>
        <% } %>
        <% if (permissions.access_nsns) { %>
            <div     id='mdl_nsn_view'    class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5   class="modal-title">Serial ID: <span id="nsn_id"></span> | <span id="_nsn_view"></span></h5>
                            <span class='float-right'>
                                <a class="btn btn-primary" id="nsn_reload"><i class="fas fa-redo"></i></a>
                                <span id='nsn_buttons'></span>
                            </span>
                        </div>
                        <div class="modal-body">
                            <ul class="nav nav-tabs" id="nsnTab" role="tablist">
                                <%- include(`${partials}/tab_head`, {id: 'nsn-view',  title: 'NSN',   spinner: 'nsn_view',  active: true}) %>
                                <%- include(`${partials}/tab_head`, {id: 'nsn-notes', title: 'Notes', spinner: 'nsn_notes', count_id: 'nsn_note'}) %>
                            </ul>
                            <div class="tab-content pt-3" id="nsnContent">
                                <div class="tab-pane fade show active" id="nsn-view" role="tabpanel" aria-labelledby="nsn-view-tab">
                                    <% if (permissions.nsn_edit) { %>
                                        <div id="div_nsn_edit" class='hidden'>
                                            <form id='form_nsn_edit'>
                                                <%- include(`${partials}/inputs/select`, {id: 'nsn_group_id_edit',          title: 'Group',          name: 'nsn[nsn_group_id]'}) %>
                                                <%- include(`${partials}/inputs/select`, {id: 'nsn_classification_id_edit', title: 'Classification', name: 'nsn[nsn_classification_id]'}) %>
                                                <%- include(`${partials}/inputs/select`, {id: 'nsn_country_id_edit',        title: 'Country',        name: 'nsn[nsn_country_id]'}) %>
                                                <%- include(`${partials}/inputs/text`,   {id: '_item_number_edit',          title: 'Item Number',    name: 'nsn[_item_number]'}) %>
                                                <input class="btn btn-success w-100 confirm" type="submit" value="Save">
                                                <a class='float-left' href='javascript:edit_nsn_reset()'>Cancel</a>
                                            </form>
                                        </div>
                                    <% } %>
                                    <div id="div_nsn_view">
                                        <%- include(`${partials}/inputs/display`, {id: 'nsn_group_id',          classes: ['text-left'], title: 'Group'}) %>
                                        <%- include(`${partials}/inputs/display`, {id: 'nsn_classification_id', classes: ['text-left'], title: 'Classification'}) %>
                                        <%- include(`${partials}/inputs/display`, {id: 'nsn_country_id',        classes: ['text-left'], title: 'Country'}) %>
                                        <%- include(`${partials}/inputs/display`, {id: '_item_number',          classes: ['text-left'], title: 'Item Number'}) %>
                                        <%- include(`${partials}/inputs/display`, {id: '_default',              classes: ['text-left'], title: 'Is Default?'}) %>
                                    </div>
                                </div>
                                <%- include(`${partials}/notes/line_note_table`, {line: 'nsn'}) %>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <% if (permissions.nsn_add) { %>
                <div id='mdl_nsn_add'     class="modal fade" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-lg" role="document">
                        <form class="modal-content" id='form_nsn_add'>
                            <div class="modal-header">
                                <h5 class="modal-title">Add NSN</h5>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" class='size_id' name='nsn[size_id]'>
                                <%- include(`${partials}/inputs/select`, {title: 'Group',          id: 'nsn_group_id_add',          name: 'nsn[nsn_group_id]',          placeholder: 'Required', required: true}) %>
                                <%- include(`${partials}/inputs/select`, {title: 'Classification', id: 'nsn_classification_id_add', name: 'nsn[nsn_classification_id]', placeholder: 'Required', required: true}) %>
                                <%- include(`${partials}/inputs/select`, {title: 'Country',        id: 'nsn_country_id_add',        name: 'nsn[nsn_country_id]',        placeholder: 'Required', required: true}) %>
                                <%- include(`${partials}/inputs/text`,   {title: 'Item Number',                                     name: 'nsn[_item_number]',          placeholder: 'Required', required: true, inputmode: 'numeric', maxLength: '8'}) %>
                                <%- include(`${partials}/inputs/select`, {title: 'Default?',                                        name: 'default', options: [{text: 'Yes', value: '1'}, {text: 'No', value: '0', selected: true}]}) %>
                            </div>
                            <div class="modal-footer">
                                <input type="submit" class="btn btn-success w-100 confirm" value='Save NSN'>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
            <% } %>
        <% } %>
        <% if (permissions.access_serials) { %>
            <div     id='mdl_serial_view' class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5   class="modal-title">Serial ID: <span id="serial_id"></span> | <span id="_serial_view"></span></h5>
                            <span class='float-right'>
                                <a class="btn btn-primary" id="serial_reload"><i class="fas fa-redo"></i></a>
                                <span id='serial_buttons'></span>
                            </span>
                        </div>
                        <div class="modal-body">
                            <ul class="nav nav-tabs" id="serialTab" role="tablist">
                                <%- include(`${partials}/tab_head`, {id: 'serial-view',  title: 'Serial', spinner: 'serial_view', active: true}) %>
                                <%- include(`${partials}/tab_head`, {id: 'serial-notes', title: 'Notes',  count_id: 'serial_note'}) %>
                            </ul>
                            <div class="tab-content pt-3" id="serialContent">
                                <div class="tab-pane fade show active" id="serial-view" role="tabpanel" aria-labelledby="serial-view-tab">
                                    <% if (permissions.serial_edit) { %>
                                        <div id="div_serial_edit" class='hidden'>
                                            <form id='form_serial_edit'>
                                                <%- include(`${partials}/inputs/text`, {id: '_serial_edit',          title: 'Serial #', name: 'serial[_serial]', maxlength: 45, required: true}) %>
                                                <%- include(`${partials}/inputs/text`, {id: 'serial_edit_locations', title: 'Location', name: '_location',       maxlength: 20, required: true, list_id: 'locations_list'}) %>
                                                <input class="btn btn-success w-100 confirm" type="submit" value="Save">
                                                <a class='float-left' href='javascript:edit_serial_reset()'>Cancel</a>
                                            </form>
                                        </div>
                                    <% } %>
                                    <div id="div_serial_view">
                                        <%- include(`${partials}/inputs/display`, {id: 'serial_location', classes: ['text-left'], title: 'Location'}) %>
                                   </div>
                                </div>
                                <%- include(`${partials}/notes/line_note_table`, {line: 'serial'}) %>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <% if (permissions.serial_add) { %>
                <div id='mdl_serial_add'  class="modal fade" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-lg" role="document">
                        <form class="modal-content" id='form_add_serial'>
                            <div class="modal-header">
                                <h5 class="modal-title">Add Serial</h5>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" class='size_id' name='serial[size_id]'>
                                <%- include(`${partials}/inputs/text`, {title: 'Serial #', id: '_serial',          name: 'serial[_serial]', maxlength: 45, required: true}) %>
                                <%- include(`${partials}/inputs/text`, {title: 'Location', id: 'serial_locations', name: '_location',       maxlength: 20, required: true, list: true, spinner: true, spinner_id: 'locations'}) %>
                            </div>
                            <div class="modal-footer">
                                <input  type="submit" class="btn btn-success w-100 confirm" value='Save Size'>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
            <% } %>
        <% } %>
        <% if (permissions.access_stock) { %>
            <div     id='mdl_stock_view'  class="modal fade" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5   class="modal-title" id="_stock_view">Stock ID: <span id="stock_id"></span></h5>
                            <span class='float-right'>
                                <a class="btn btn-primary" id="stock_reload"><i class="fas fa-redo"></i></a>
                                <span id='stock_buttons'></span>
                            </span>
                        </div>
                        <div class="modal-body">
                            <ul class="nav nav-tabs" id="stockTab" role="tablist">
                                <%- include(`${partials}/tab_head`, {id: 'stock-view',     title: 'Stock',       spinner: 'stock_view',     active: true}) %>
                                <%- include(`${partials}/tab_head`, {id: 'stock-adjusts',  title: 'Adjustments', spinner: 'stock_adjusts',  count_id: 'stock_adjusts',  permission: 'access_adjusts'}) %>
                                <%- include(`${partials}/tab_head`, {id: 'stock-receipts', title: 'Receipts',    spinner: 'stock_receipts', count_id: 'stock_receipts', permission: 'access_receipt_lines'}) %>
                                <%- include(`${partials}/tab_head`, {id: 'stock-issues',   title: 'Issues',      spinner: 'stock_issues',   count_id: 'stock_issues',   permission: 'access_issue_lines'}) %>
                                <%- include(`${partials}/tab_head`, {id: 'stock-returns',  title: 'Returns',     spinner: 'stock_returns',  count_id: 'stock_returns',  permission: 'access_issue_line_returns'}) %>
                                <%- include(`${partials}/tab_head`, {id: 'stock-notes',    title: 'Notes',       spinner: 'stock_notes',    count_id: 'stock_note',     permission: 'access_notes'}) %>
                            </ul>
                            <div class="tab-content pt-3" id="stockContent">
                                <div class="tab-pane fade show active" id="stock-view" role="tabpanel" aria-labelledby="stock-view-tab">
                                    <% if (permissions.stock_edit) { %>
                                        <div id="div_stock_edit" class='hidden'>
                                            <form id='form_stock_edit'>
                                                <%- include(`${partials}/inputs/text`, {id: 'stock_edit_location', title: 'Location', name: '_location', maxlength: 20, required: true, list_id: 'locations_list'}) %>
                                                <input class="btn btn-success w-100 confirm" type="submit" value="Save">
                                                <a class='float-left' href='javascript:edit_stock_reset()'>Cancel</a>
                                            </form>
                                        </div>
                                    <% } %>
                                    <div id="div_stock_view">
                                        <%- include(`${partials}/inputs/display`, {id: 'stock_location', classes: ['text-left'], title: 'Location'}) %>
                                        <%- include(`${partials}/inputs/display`, {id: '_qty',           classes: ['text-left'], title: 'Quantity'}) %>
                                    </div>
                                </div>
                                <% if (permissions.access_adjusts) { %>
                                    <div class="tab-pane fade" id="stock-adjusts" role="tabpanel" aria-labelledby="stock-adjusts-tab">
                                        <table class="table table-sm table-hover">
                                            <thead class="thead-dark">
                                                <th class="w-25" onclick="sortTable(0, 'tbl_stock_adjusts')">Date</th>
                                                <th class="w-10" onclick="sortTable(1, 'tbl_stock_adjusts')">Type</th>
                                                <th class="w-10" onclick="sortTable(2, 'tbl_stock_adjusts')">Qty</th>
                                                <th class="w-10" onclick="sortTable(3, 'tbl_stock_adjusts')">Variance</th>
                                                <th class="w-45" onclick="sortTable(4, 'tbl_stock_adjusts')">User</th>
                                            </thead>
                                            <tbody id="tbl_stock_adjusts"></tbody>
                                        </table>
                                    </div>
                                <% } %>
                                <% if (permissions.access_receipt_lines) { %>
                                    <div class="tab-pane fade" id="stock-receipts" role="tabpanel" aria-labelledby="stock-receipts-tab">
                                        <table class="table table-sm table-hover">
                                            <thead class="thead-dark">
                                                <th class="w-45" onclick="sortTable(0, 'tbl_stock_receipts')">Date</th>
                                                <th class="w-10" onclick="sortTable(1, 'tbl_stock_receipts')">Qty</th>
                                                <th class="w-45" onclick="sortTable(2, 'tbl_stock_receipts')">User</th>
                                                <th><i class="fas fa-search"></i></th>
                                            </thead>
                                            <tbody id="tbl_stock_receipts"></tbody>
                                        </table>
                                    </div>
                                <% } %>
                                <% if (permissions.access_issue_lines) { %>
                                    <div class="tab-pane fade" id="stock-issues" role="tabpanel" aria-labelledby="stock-issues-tab">
                                        <table class="table table-sm table-hover">
                                            <thead class="thead-dark">
                                                <th class="w-40" onclick="sortTable(0, 'tbl_stock_issues')">Date</th>
                                                <th class="w-40" onclick="sortTable(1, 'tbl_stock_issues')">To</th>
                                                <th class="w-10" onclick="sortTable(2, 'tbl_stock_issues')">Qty</th>
                                                <th class="w-10" onclick="sortTable(3, 'tbl_stock_issues')">Returned?</th>
                                                <th><i class="fas fa-search"></i></th>
                                            </thead>
                                            <tbody id="tbl_stock_issues"></tbody>
                                        </table>
                                    </div>
                                <% } %>
                                <% if (permissions.access_issue_line_returns) { %>
                                    <div class="tab-pane fade" id="stock-returns" role="tabpanel" aria-labelledby="stock-returns-tab">
                                        <table class="table table-sm table-hover">
                                            <thead class="thead-dark">
                                                <th class="w-45" onclick="sortTable(0, 'tbl_stock_returns')">Date</th>
                                                <th class="w-45" onclick="sortTable(1, 'tbl_stock_returns')">From</th>
                                                <th class="w-10" onclick="sortTable(2, 'tbl_stock_returns')">Qty</th>
                                                <th><i class="fas fa-search"></i></th>
                                            </thead>
                                            <tbody id="tbl_stock_returns"></tbody>
                                        </table>
                                    </div>
                                <% } %>
                                <%- include(`${partials}/notes/line_note_table`, {line: 'stock'}) %>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <% if (permissions.stock_add) { %>
                <div id='mdl_add_stock'   class="modal fade" tabindex="-1" role="dialog">
                    <div class="modal-dialog modal-lg" role="document">
                        <form class="modal-content" id='form_add_stock'>
                            <div class="modal-header">
                                <h5 class="modal-title">Add Serial</h5>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" class='size_id' name='stock[size_id]'>
                                <%- include(`${partials}/inputs/text`, {title: 'Location', id: 'stock_locations', name: '_location', maxlength: 20, required: true, list: true, spinner: true, spinner_id: 'locations'}) %>
                            </div>
                            <div class="modal-footer">
                                <input  type="submit" class="btn btn-success w-100 confirm" value='Save Size'>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </form>
                    </div>
                </div>
            <% } %>
        <% } %>
    </div>
</section>
<%- include(`${partials}/foot/full`) %>
<!-- get/spinner/XHRsend/send from notes include -->
<script src="/js/data/addFormListener.js"></script>
<script src='/js/tabs.js'></script>
<script>showTab('<%= tab %>');</script>
<!-- <script src='/js/show.js'></script> -->
<script src='/js/utils/getLineNotes.js'></script>
<script src="/js/stores/sizes/show/getSize.js"></script>
<script async>getSize()</script>
<% if (permissions.nsn_add || permissions.nsn_edit || permissions.serial_add || permissions.serial_edit || permissions.stock_add || permissions.stock_edit) { %>
    <script src="/js/stores/locations/getLocations.js"></script>
<% } %>
<% if (permissions.access_nsns) { %>
    <script src="/js/stores/sizes/show/nsns/view.js"></script>
    <script async>getNSNs()</script>
    <script>
        let get_NSN = function (nsn_id) {
            getNSNView(
                nsn_id,
                {
                    edit:   <%= permissions.nsn_edit   || false %>,
                    delete: <%= permissions.nsn_delete || false %>
                }
            );
        };
        $('#mdl_nsn_view').on('show.bs.modal', function(event) {
            get_NSN(event.relatedTarget.dataset.nsn_id);
        });
        window.addEventListener('load', function () {
            let nsn_id     = document.querySelector('#nsn_id'),
                nsn_reload = document.querySelector('#nsn_reload');
            nsn_reload.addEventListener('click', function () {
                get_NSN(nsn_id.innerText);
            });
        });
    </script>
    <% if (permissions.access_notes) { %>
        <script src="/js/stores/sizes/show/nsns/getNotes.js"></script>
        <script>
            let get_NSN_notes = function (nsn_id) {
                getNSNNotes(
                    nsn_id,
                    {
                        edit:   <%= permissions.note_edit   || false %>,
                        delete: <%= permissions.note_delete || false %>
                    }
                );
            };
            $('#mdl_nsn_view').on('show.bs.modal', function(event) {
                get_NSN_notes(event.relatedTarget.dataset.nsn_id);
            });
            window.addEventListener('load', function () {
                let nsn_sel_system = document.querySelector('#nsn_sel_system');
                nsn_reload.addEventListener('click', function () {
                    get_NSN_notes(nsn_id.innerText);
                });
                if (nsn_sel_system && nsn_id) nsn_sel_system.addEventListener('change', function () {
                    get_NSN_notes(nsn_id.innerText);
                });
            });
        </script>
    <% } %>
    <% if (permissions.nsn_add || permissions.nsn_edit) { %>
        <script src="/js/stores/sizes/show/nsns/categories.js"></script>
    <% } %>
    <% if (permissions.nsn_edit) { %>
        <script src="/js/stores/sizes/show/nsns/edit.js"></script>
    <% } %>
    <% if (permissions.nsn_add) { %>
        <script src="/js/stores/sizes/show/nsns/add.js"></script>
    <% } %>
<% } %>
<% if (permissions.access_serials) { %>
    <script src="/js/stores/sizes/show/serials/view.js"></script>
    <script async>getSerials()</script>
    <script>
        let get_serial = function (serial_id) {
            getSerialView(
                serial_id,
                {
                    edit:   <%= permissions.serial_edit   || false %>,
                    delete: <%= permissions.serial_delete || false %>
                }
            );
        };
        $('#mdl_serial_view').on('show.bs.modal', function(event) {
            get_serial(event.relatedTarget.dataset.serial_id);
        });
        window.addEventListener('load', function () {
            let serial_id     = document.querySelector('#serial_id'),
                serial_reload = document.querySelector('#serial_reload');
            serial_reload.addEventListener('click', function () {
                get_serial(serial_id.innerText);
            });
        });
    </script>
    <% if (permissions.access_notes) { %>
        <script src="/js/stores/sizes/show/serials/getNotes.js"></script>
        <script>
            let get_serial_notes = function (serial_id) {
                getSerialNotes(
                    serial_id,
                    {
                        edit:   <%= permissions.note_edit   || false %>,
                        delete: <%= permissions.note_delete || false %>
                    }
                );
            };
            $('#mdl_serial_view').on('show.bs.modal', function(event) {
                get_serial_notes(event.relatedTarget.dataset.serial_id);
            });
            window.addEventListener('load', function () {
                let serial_sel_system = document.querySelector('#serial_sel_system');
                serial_reload.addEventListener('click', function () {
                    get_serial_notes(serial_id.innerText);
                });
                if (serial_sel_system) serial_sel_system.addEventListener('change', function () {
                    get_serial_notes(serial_id.innerText);
                });
            });
        </script>
    <% } %>
    <% if (permissions.serial_edit) { %>
        <script src="/js/stores/sizes/show/serials/edit.js"></script>
    <% } %>
    <% if (permissions.serial_add) { %>
        <script src="/js/stores/sizes/show/serials/add.js"></script>
    <% } %>
<% } %>
<% if (permissions.access_stock) { %>
    <script src="/js/stores/sizes/show/stock/view.js"></script>
    <script async>getStocks()</script>
    <script>
        let get_stock = function (stock_id) {
            getStockView(
                stock_id,
                {
                    edit:   <%= permissions.stock_edit   || false %>,
                    delete: <%= permissions.stock_delete || false %>
                }
            );
        };
        $('#mdl_stock_view').on('show.bs.modal', function(event) {
            get_stock(event.relatedTarget.dataset.stock_id);
        });
        window.addEventListener('load', function () {
            let stock_id     = document.querySelector('#stock_id'),
                stock_reload = document.querySelector('#stock_reload');
            stock_reload.addEventListener('click', function () {
                get_stock(stock_id.innerText);
            });
        });
    </script>
    <% if (permissions.access_notes) { %>
        <script src="/js/stores/sizes/show/stock/getNotes.js"></script>
        <script>
            let get_stock_notes = function (stock_id) {
                getStockNotes(
                    stock_id,
                    {
                        edit:   <%= permissions.note_edit   || false %>,
                        delete: <%= permissions.note_delete || false %>
                    }
                );
            };
            $('#mdl_stock_view').on('show.bs.modal', function(event) {
                get_stock_notes(event.relatedTarget.dataset.stock_id);
            });
            window.addEventListener('load', function () {
                let stock_sel_system = document.querySelector('#stock_sel_system');
                stock_reload.addEventListener('click', function () {
                    get_stock_notes(stock_id.innerText);
                });
                if (stock_sel_system) stock_sel_system.addEventListener('change', function () {
                    get_stock_notes(stock_id.innerText);
                });
            });
        </script>
    <% } %>
    <% if (permissions.access_adjusts) { %>
        <script src="/js/stores/sizes/show/stock/getAdjusts.js"></script>
    <% } %>
    <% if (permissions.access_receipt_lines) { %>
        <script src="/js/stores/sizes/show/stock/getReceipts.js"></script>
    <% } %>
    <% if (permissions.access_issue_lines) { %>
        <script src="/js/stores/sizes/show/stock/getIssues.js"></script>
    <% } %>
    <% if (permissions.access_issue_line_returns) { %>
        <script src="/js/stores/sizes/show/stock/getReturns.js"></script>
    <% } %>
    <% if (permissions.stock_edit) { %>
        <script src="/js/stores/sizes/show/stock/edit.js"></script>
    <% } %>
    <% if (permissions.serial_add) { %>
        <script src="/js/stores/sizes/show/serials/add.js"></script>
    <% } %>
<% } %>
<% if (permissions.access_requests) { %>
    <script src="/js/stores/sizes/show/getRequests.js"></script>
    <script async>getRequests()</script>
<% } %>
<% if (permissions.access_orders) { %>
    <script src="/js/stores/sizes/show/getOrders.js"></script>
    <script async>getOrders()</script>
<% } %>
<% if (permissions.access_receipts) { %>
    <script src="/js/stores/sizes/show/getReceipts.js"></script>
    <script async>getReceipts()</script>
<% } %>
<% if (permissions.access_issues) { %>
    <script src="/js/stores/sizes/show/getIssues.js"></script>
    <script async>getIssues()</script>
<% } %>
<% if (permissions.size_edit) { %>
    <script src="/js/stores/sizes/show/getSizeEdit.js"></script>
    <script async>getSizeEdit()</script>
<% } %>
<%- include(`${partials}/foot/htmlClose`) %>