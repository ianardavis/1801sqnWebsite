<%- include('../../partials/head/head') %>
<body>
<%- include('../../partials/head/flash') %>
<section id='body'>
<section class='container'>
    <form id='sizeForm'>
        <input type='hidden' name='details[item_id]', value='<%= item.item_id %>'>
        <div class='row'>
            <div class='col-12 col-sm-8 bordered mb-1'>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Add Size to</span>
                    </div>
                    <p class="form-control"><%= item._description %></p>
                </div>
                <div>
                    <input class='btn btn-success confirm' type='submit' value='Save'>
                    <a class='float-left' href='javascript:close()'>Cancel</a>
                </div>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Issueable</span>
                    </div>
                    <select class='form-control' name="details[_issueable]">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Orderable</span>
                    </div>
                    <select class='form-control' name="details[_orderable]">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Has Serial #</span>
                    </div>
                    <select class='form-control' name="details[_serials]">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Has NSNs</span>
                    </div>
                    <select class='form-control' name="details[_nsns]">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Supplier</span>
                    </div>
                    <select class='form-control' name='details[supplier_id]' type='text'>
                        <% suppliers.forEach(supplier => { %>
                            <option value='<%= supplier.supplier_id %>'<% if (supplier._default) { %> selected <% } %>><%= supplier._name %></option>         
                        <% }) %>
                    </select>
                </div>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Demand Page</span>
                    </div>
                    <input class='form-control' type='text' name='details[_demand_page]' maxlength='20'>
                </div>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Cell</span>
                    </div>
                    <input class='form-control' type='text' name='details[_demand_cell]' maxlength='3'>
                </div>
                <div class="input-group mb-1">
                    <div class="input-group-prepend w-30">
                        <span class="input-group-text w-100">Ordering Details</span>
                    </div>
                    <textarea class='form-control' name='details[_ordering_details]' rows='5' maxlength='1000'></textarea>
                </div>
            </div>
            <div class='col-12 col-sm-4 bordered mb-1'>
                <input class='form-control' type='text' id='size' placeholder='Enter a new size...'>
                <a class='btn btn-sm btn-primary w-100 mb-1' href='javascript:addSize()'>Add Size</a>
                <table id='sizeTable' class='w-100'>
                    <thead>
                        <th class='w-100'>Size</th>
                        <th><i class='fas fa-trash-alt'></i></th>
                    </thead>
                    <tbody id='sizes'>
                    </tbody>
                </table>
            </div>
        </div>
    </form>
</section>
<% include ../../partials/foot/noNav %>
<script src='/js/removeID.js'></script>
<script>
    window.addEventListener( "load", function () {
        let form = document.querySelector("#sizeForm");
        form.addEventListener("submit", function (event) {
            event.preventDefault();
            sendData(form, 'POST', '/stores/sizes');
        });
    });
    function addSize() {
        let size  = document.querySelector('#size'),
            sizes = document.querySelector('#sizes'),
            size_text = size.value.replace(/ /g, '_').replace(/./g, '_').replace(/\//g, '_').replace(/\\/g, '_');
        if (size.value !== '') {
            if (!document.querySelector('#size' + size_text)) {
                let tr      = document.createElement('tr'),
                    del_td  = document.createElement('td'),
                    del_btn = document.createElement('a'),
                    size_td = document.createElement('td'),
                    size_input = document.createElement('input');
                tr.id = 'size' + size_text;

                size_input.value = size.value;
                size_input.classList.add('form-control');
                size_input.classList.add('form-control-sm');
                size_input.name = 'sizes[]';
                size_td.appendChild(size_input);

                del_btn.href='javascript:removeID(size' + size.value + ')';
                del_btn.classList.add('btn');
                del_btn.classList.add('btn-sm');
                del_btn.classList.add('btn-danger');
                del_btn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                del_td.appendChild(del_btn);

                tr.appendChild(size_td);
                tr.appendChild(del_td);
                sizes.appendChild(tr);
                size.value = '';
            };
        };
    };
</script>
<% include ../../partials/foot/htmlClose %>