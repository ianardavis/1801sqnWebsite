<% include ../../partials/head/full %>
<section class="mb-2">
	<nav class="navbar navbar-expand navbar-light bg-nav">
		<ul class="navbar-nav mr-auto">
			<li class="nav-item">
				<a class="nav-link stores_nav" href="/stores">Stores</a>
			</li>
			<li class="nav-item">
				<a class="nav-link stores_nav" href="/stores/demands">Demands</a>
			</li>
		</ul>
	</nav>
</section>
<section>
	<div class="container mt-3 pt-3">
		<div class="container mt-3 pt-3">
			<div class="row">
				<label class="col-3 col-form-label text-right"  for="su">Suppliers:</label>
				<select id="su" class='form-control col-9' type="text" onchange=filterSelects()>
					<option value="0" <% if (query.su === 0) { %>selected<% } %>>All</option>
					<% suppliers.forEach(supplier => { %>
						<option value="<%= supplier.supplier_id %>" <% if (query.su === supplier.supplier_id) { %>selected<% } %>>
							<%= supplier._name %>
						</option>
					<% }); %>
				</select>
			</div>
			<div class="row">
				<label class="col-3 col-form-label text-right"  for="cd">Completed Demands:</label>
				<select id="cd" class='form-control col-9' type="text" onchange=filterSelects()>
					<option value="1" <% if (query.cd === 1) { %>selected<% } %>>Include</option>
					<option value="2" <% if (query.cd === 2) { %>selected<% } %>>Exclude</option>
					<option value="3" <% if (query.cd === 3) { %>selected<% } %>>Only</option>
				</select>
			</div>
		</div>
		<div>
			<table id="demandTable" class="table table-sm table-hover mx-auto w-100">
				<thead class="thead-dark">
					<th class="w-15" onclick="sortTable(0, 'demandTable')">Supplier</th>
					<th class="w-15" onclick="sortTable(1, 'demandTable')">Demand Date</th>
					<th class="w-15" onclick="sortTable(1, 'demandTable')">Raised By</th>
					<th class="w-15" onclick="sortTable(1, 'demandTable')">Complete</th>
				</thead>
				<tbody>
					<% if (demands) { %>
						<% demands.forEach((demand) => { %>
							<tr>
								<td><a href="/stores/demands/<%= demand.demand_id %>"> <%= demand.supplier._name %></a></td>
								<td><a href="/stores/demands/<%= demand.demand_id %>"> <%= demand._date.toDateString() %></a></td>
								<td><a href="/stores/demands/<%= demand.demand_id %>"> <%= demand.user.rank._rank %> <%= demand.user._name %>, <%= demand.user._ini %></a></td>
								<td><input class="form-control form-control-sm" type="checkbox" disabled<% if (demand._complete) { %> checked <% } %>></td>
							</tr>
						<% }) %>
					<% } %>
				</tbody>
			</table>
		</div>
	</div>
</section>
<% include ../../partials/foot/full %>
<script src="/js/tableSort.js"></script>
<script src="/js/filters.js"></script>
<script>
    function filterSelects() {
        filter(['cd', 'su'], "/stores/demands");
    };
</script>
<% include ../../partials/foot/htmlClose %>