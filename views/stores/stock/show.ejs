<%- include('../../partials/head/head') %>
<body>
<%- include('../../partials/head/flash') %>
<section id='body'>
<section class="container">
	<ul class="nav nav-tabs" id="mainTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link" id="details-tab" data-toggle="tab" href="#details" role="tab" aria-controls="details" aria-selected="true">
                Details
            </a>
        </li>
        <% if (permissions.access_adjusts) { %>
            <li class="nav-item">
                <a class="nav-link" id="adjusts-tab" data-toggle="tab" href="#adjusts" role="tab" aria-controls="adjusts" aria-selected="true">
                    Adjustments (<%= stock.adjusts.length %>)
                </a>
            </li>
        <% } %>
        <% if (permissions.access_receipts) { %>
            <li class="nav-item">
                <a class="nav-link" id="receipts-tab" data-toggle="tab" href="#receipts" role="tab" aria-controls="receipts" aria-selected="true">
                    Receipts (<%= stock.receipts.length %>)
                </a>
            </li>
        <% } %>
        <% if (permissions.access_issues) { %>
            <li class="nav-item">
                <a class="nav-link" id="issues-tab" data-toggle="tab" href="#issues" role="tab" aria-controls="issues" aria-selected="true">
                    Issues (<%= stock.issues.length %>
                </a>
            </li>
        <% } %>
        <% if (permissions.access_returns) { %>
            <li class="nav-item">
                <a class="nav-link" id="returns-tab" data-toggle="tab" href="#returns" role="tab" aria-controls="returns" aria-selected="true">
                    Returns (<%= stock.returns.length %>
                </a>
            </li>
        <% } %>
        <% if (permissions.access_notes) { %>
            <li class="nav-item">
                <a class="nav-link" id="notes-tab" data-toggle="tab" href="#notes" role="tab" aria-controls="notes" aria-selected="true">
                    Notes (<%= notes.notes.length %>)
                </a>
            </li>
        <% } %>
    </ul>
    <div class="tab-content pt-3" id="myTabContent">
        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
            <div class="container">
				<div class="input-group mb-1">
                    <div class="input-group-prepend w-20">
                        <span class="input-group-text w-100">Location</span>
                    </div>
					<p class="form-control"><%= stock.location._location %></p>
					<div class="input-group-append">
						<a class='btn btn-warning' href='javascript:edit("stock",<%= stock.stock_id %>,{height:190})'>
							<i class='fas fa-pencil-alt'></i>
						</a>
					</div>
                </div>
			</div>
		</div>
        <% if (permissions.access_adjusts) { %>
			<div class="tab-pane fade" id="adjusts" role="tabpanel" aria-labelledby="adjusts-tab">
				<div class="container">
					<% if (permissions.adjust_add) { %> 
						<a class="float-left btn btn-primary mr-1" href='javascript:add("adjusts",{"height":361,"queries":"stock_id=<%= stock.stock_id %>&adjustType=Count"})'>
							<i class='fas fa-pencil-alt'></i>
						</a>
						<a class="float-left btn btn-danger mr-1" href='javascript:add("adjusts",{"height":361,"queries":"stock_id=<%= stock.stock_id %>&adjustType=Scrap"})'>
							<i class='fas fa-trash-alt'></i>
						</a>
					<% } %>
					<table class="table table-sm table-hover smallFont07 limit-height-200 w-100">
						<thead class="thead-dark">
							<th class="w-25" onclick="sortTable(0, 'adjustsTable')">Date</th>
							<th class="w-10" onclick="sortTable(1, 'adjustsTable')">Type</th>
							<th class="w-10" onclick="sortTable(2, 'adjustsTable')">Qty</th>
							<th class="w-10" onclick="sortTable(3, 'adjustsTable')">Variance</th>
							<th class="w-45" onclick="sortTable(4, 'adjustsTable')">User</th>
						</thead>
						<tbody id="adjustsTable">
							<% if (stock.adjusts && stock.adjusts.length > 0) { %>
								<% stock.adjusts.forEach(adjust => { %>
									<tr>
										<td data-sort="<%= adjust._date.getTime() %>">
											<a href="#"><%= adjust._date.toDateString() %></a>
										</td>
										<td>
											<a href="#"><%= adjust._type %></a>
										</td>
										<td>
											<a href="#"><%= adjust._qty %></a>
										</td>
										<td>
											<a href="#"><%= adjust._qty_difference %></a>
										</td>
										<td>
											<a href="#"><%= adjust.user.rank._rank %> <%= adjust.user._name %>, <%= adjust.user._ini %></a>
										</td>
									</tr>
								<% }) %>
							<% } %>
						</tbody>
					</table>
				</div>
			</div>
        <% } %>
        <% if (permissions.access_receipts) { %>
			<div class="tab-pane fade" id="receipts" role="tabpanel" aria-labelledby="receipts-tab">
				<div class="container">
					<table class="table table-sm table-hover smallFont07 limit-height-200 w-100">
						<thead class="thead-dark">
							<th class="w-45" onclick="sortTable(0, 'receiptTable')">Date</th>
							<th class="w-10" onclick="sortTable(1, 'receiptTable')">Qty</th>
							<th class="w-45" onclick="sortTable(2, 'receiptTable')">User</th>
							<th><i class="fas fa-search"></i></th>
						</thead>
						<tbody id="receiptTable">
							<% if (stock.receipts && stock.receipts.length > 0) { %>
								<% stock.receipts.forEach(receipt => { %>
									<tr>
										<td data-sort="<%= receipt.receipt._date.getTime() %>">
											<%= receipt.receipt._date.toDateString() %>
										</td>
										<td>
											<%= receipt._qty %>
										</td>
										<td>
											<%= receipt.receipt.user.rank._rank %> <%= receipt.receipt.user._name %>, <%= receipt.receipt.user._ini %>
										</td>
										<td>
											<a class='btn btn-sm btn-primary' href="/stores/receipts/<%= receipt.receipt_id %>">
												<i class="fas fa-search"></i>
											</a>
										</td>
									</tr>
								<% }) %>
							<% } %>
						</tbody>
					</table>
				</div>
			</div>
        <% } %>
        <% if (permissions.access_issues) { %>
			<div class="tab-pane fade" id="issues" role="tabpanel" aria-labelledby="issues-tab">
				<div class="container">
					<table class="table table-sm table-hover smallFont07 limit-height-200 w-100">
						<thead class="thead-dark">
							<th class="w-40" onclick="sortTable(0, 'issueTable')">Date</th>
							<th class="w-40" onclick="sortTable(1, 'issueTable')">To</th>
							<th class="w-10" onclick="sortTable(2, 'issueTable')">Qty</th>
							<th class="w-10" onclick="sortTable(3, 'issueTable')">Returned?</th>
							<th><i class="fas fa-search"></i></th>
						</thead>
						<tbody id="issueTable">
							<% if (stock.issues && stock.issues.length > 0) { %>
								<% stock.issues.forEach(issue => { %>
									<tr>
										<td data-sort="<%= issue.issue._date.getTime() %>">
											<%= issue.issue._date.toDateString() %>
										</td>
										<td>
											<%= issue.issue._to.rank._rank %> <%= issue.issue._to._name %>, <%= issue.issue._to._ini %>
										</td>
										<td>
											<%= issue._qty %>
										</td>
										<td>
											<input class="form-control form-control-sm" type="checkbox" disabled<% if (issue.return_line_id !== null) { %> selected <% } %>>
										</td>
										<td>
											<a class='btn btn-sm btn-primary' href="/stores/issues/<%= issue.issue_id %>">
												<i class="fas fa-search"></i>
											</a>
										</td>
									</tr>
								<% }) %>
							<% } %>
						</tbody>
					</table>
				</div>
			</div>
        <% } %>
        <% if (permissions.access_returns) { %>
			<div class="tab-pane fade" id="returns" role="tabpanel" aria-labelledby="returns-tab">
				<table class="table table-sm table-hover smallFont07 limit-height-200 w-100">
					<thead class="thead-dark">
						<th class="w-45" onclick="sortTable(0, 'returnTable')">Date</th>
						<th class="w-45" onclick="sortTable(1, 'returnTable')">From</th>
						<th class="w-10" onclick="sortTable(2, 'returnTable')">Qty</th>
						<th><i class="fas fa-search"></i></th>
					</thead>
					<tbody id="returnTable">
						<% if (stock.returns && stock.returns.length > 0) { %>
							<% stock.returns.forEach(_return => { %>
								<tr>
									<td data-sort="<%= _return.return._date.getTime() %>">
										<%= _return.return._date.toDateString() %>
									</td>
									<td>
										<%= _return._from.user.rank._rank %> <%= _return._from.user._name %>, <%= _return._from.user._ini %>
									</td>
									<td>
										<%= _return._qty %>
									</td>
									<td>
										<a class='btn btn-sm btn-primary' href="/stores/returns/<%= _return.return_id %>"><i class="fas fa-search"></i></a>
									</td>
								</tr>
							<% }) %>
						<% } %>
					</tbody>
				</table>
			</div>
        <% } %>
		<% if (permissions.access_notes) { %>
			<div class="tab-pane fade" id="notes" role="tabpanel" aria-labelledby="notes-tab">
				<% include ../../partials/noteTable %>
			</div>
		<% } %>
	</div>
</section>
<% include ../../partials/foot/noNav %>
<script>
    function filterSelects() {
        filter(['system'],"/stores/stock/<%= stock.stock_id %>/edit");
    };
    showTab('<%= show_tab %>');
</script>
<% include ../../partials/foot/htmlClose %>