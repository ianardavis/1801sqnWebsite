<% include ../../partials/head/full %>
<section class="mb-2">
    <nav class="navbar navbar-expand navbar-light bg-nav">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores">Stores</a>
            </li>
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores/items">Items</a>
            </li>
            <li class="nav-item">
				<a class="nav-link stores_nav" href="/stores/items/<%= stock.item_size.item_id %>">
					<%= stock.item_size.item._description %>
				</a>
            </li>
            <li class="nav-item">
				<a class="nav-link stores_nav" href="/stores/item_sizes/<%= stock.item_size.itemsize_id %>">
					Size: <%= stock.item_size._size %>
				</a>
            </li>
            <li class="nav-item">
				<a class="nav-link stores_nav" href="/stores/stock/<%= stock.stock_id %>/edit">
					Location: <%= stock.location._location %>
				</a>
            </li>
        </ul>
    </nav>
</section>
<section class="mb-2">
	<nav class="navbar navbar-expand navbar-dark bg-dark stores">
		<ul class="navbar-nav mr-auto">
			<li class="nav-item dropdown">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Options
				</a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdown">
					<% if (permissions.adjusts_add) { %> 
						<a class="dropdown-item" href="/stores/adjusts/new?stock_id=<%= stock.stock_id %>&adjustType=Count">Count</a>
						<a class="dropdown-item" href="/stores/adjusts/new?stock_id=<%= stock.stock_id %>&adjustType=Scrap">Scrap</a>
					<% } %>
					<% if (permissions.notes_add) { %>
						<a class="dropdown-item" href="/stores/notes/new?table=stock&id=<%= stock.stock_id %>">Add Note</a>
						<div class="dropdown-divider"></div>
					<% } %>
					<a class="dropdown-item" href="/stores/items_sizes/<%= stock.item_size.itemsize_id %>/edit">
						Back to <%= stock.item_size.item._description %>/Size: <%= stock.item_size._size %>
					</a>
				</div>
			</li>
		</ul>
	</nav>
</section>
<section class="container">
	<div class="row">
		<div class="col-12 col-md-3 mx-auto bordered mb-2">
			<h4>Location</h4>
			<form action="/stores/stock/<%= stock.stock_id %>?_method=PUT" method="POST" onsubmit="return confirm('Confirm changes?');">
				<div class="mb-2">
					<input type="hidden" name="stock[stock_id]" value="<%= stock.stock_id %>" readonly>
					<input type="text" class="form-control" name="stock[location_id]" maxlength="10" value="<%= stock.location._location %>" required>
				</div>
				<div>
					<input type="submit" class="btn btn-success" value="Save">
				</div>
			</form>
		</div>
		<div class="col-12 col-md-9 mx-auto bordered mb-2">
			<% include ../../partials/noteTable %>
		</div>
		<div class="col-12 col-md-12 mx-auto bordered mb-2">
			<a class="my-3" data-toggle="collapse" href="#collapseAdjust" role="button" aria-expanded="false" aria-controls="collapseAdjust">
				<h4>Adjustments (<%= stock.adjusts.length %>)</h4>
			</a>
			<div class="collapse mb-3" id="collapseAdjust">
				<table class="table table-sm table-hover smallFont07 limit-height-200 w-100">
					<thead class="thead-dark">
						<th class="w-25" onclick="sortTable(0, 'adjustsTable')">Date</th>
						<th class="w-10" onclick="sortTable(1, 'adjustsTable')">Type</th>
						<th class="w-10" onclick="sortTable(2, 'adjustsTable')">Adjust Qty</th>
						<th class="w-10" onclick="sortTable(3, 'adjustsTable')">Variation</th>
						<th class="w-45" onclick="sortTable(4, 'adjustsTable')">User</th>
					</thead>
					<tbody id="adjustsTable">
						<% if (stock.adjusts && stock.adjusts.length > 0) { %>
							<% stock.adjusts.forEach(adjust => { %>
								<tr>
									<td data-sort="<%= adjust._date.getTime() %>">
										<a href="#"><%= adjust._date.toDateString() %></a>
									</td>
									<td>
										<a href="#"><%= adjust._type %></a>
									</td>
									<td>
										<a href="#"><%= adjust._qty %></a>
									</td>
									<td>
										<a href="#"><%= adjust._qty_difference %></a>
									</td>
									<td>
										<a href="#"><%= adjust.user.rank._rank %> <%= adjust.user._name %>, <%= adjust.user._ini %></a>
									</td>
								</tr>
							<% }) %>
						<% } %>
					</tbody>
				</table>
			</div>
		</div>
		<div class="col-12 col-md-12 mx-auto bordered mb-2">
			<a class="my-3" data-toggle="collapse" href="#collapseReceipt" role="button" aria-expanded="false" aria-controls="collapseReceipt">
				<h4>Receipts (<%= stock.receipts_ls.length %>)</h4>
			</a>
			<div class="collapse mb-3" id="collapseReceipt">
				<table class="table table-sm table-hover smallFont07 limit-height-200 w-100">
					<thead class="thead-dark">
						<th class="w-45" onclick="sortTable(0, 'receiptTable')">Date</th>
						<th class="w-10" onclick="sortTable(1, 'receiptTable')">Qty</th>
						<th class="w-45" onclick="sortTable(2, 'receiptTable')">User</th>
						<th><i class="fas fa-search"></i></th>
					</thead>
					<tbody id="receiptTable">
						<% if (stock.receipts_ls && stock.receipts_ls.length > 0) { %>
							<% stock.receipts_ls.forEach(receipt => { %>
								<tr>
									<td data-sort="<%= receipt.receipt._date.getTime() %>">
										<a href="#"><%= receipt.receipt._date.toDateString() %></a>
									</td>
									<td>
										<a href="#"><%= receipt._qty %></a>
									</td>
									<td>
										<a href="#"><%= receipt.receipt.user.rank._rank %> <%= receipt.receipt.user._name %>, <%= receipt.receipt.user._ini %></a>
									</td>
									<td>
										<a href="/stores/issues/<%= receipt.receipt_id %>"><i class="fas fa-search"></i></a>
									</td>
								</tr>
							<% }) %>
						<% } %>
					</tbody>
				</table>
			</div>
		</div>
		<div class="col-12 col-md-12 mx-auto bordered mb-2">
			<a class="my-3" data-toggle="collapse" href="#collapseIssue" role="button" aria-expanded="false" aria-controls="collapseIssue">
				<h4>Issues (<%= stock.issues_ls.length %>)</h4>
			</a>
			<div class="collapse mb-3" id="collapseIssue">
				<table class="table table-sm table-hover smallFont07 limit-height-200 w-100">
					<thead class="thead-dark">
						<th class="w-40" onclick="sortTable(0, 'issueTable')">Date</th>
						<th class="w-40" onclick="sortTable(1, 'issueTable')">To</th>
						<th class="w-10" onclick="sortTable(2, 'issueTable')">Qty</th>
						<th class="w-10" onclick="sortTable(3, 'issueTable')">Returned?</th>
						<th><i class="fas fa-search"></i></th>
					</thead>
					<tbody id="issueTable">
						<% if (stock.issues_ls && stock.issues_ls.length > 0) { %>
							<% stock.issues_ls.forEach(issue => { %>
								<tr>
									<td data-sort="<%= issue.issue._date.getTime() %>">
										<a href="#"><%= issue.issue._date.toDateString() %></a>
									</td>
									<td>
										<a href="#"><%= issue.issue._to.rank._rank %> <%= issue.issue._to._name %>, <%= issue.issue._to._ini %></a>
									</td>
									<td>
										<a href="#"><%= issue._qty %></a>
									</td>
									<td>
										<input class="form-control form-control-sm" type="checkbox" disabled<% if (issue.return_line_id !== null) { %> selected <% } %>>
									</td>
									<td>
										<a href="/stores/issues/<%= issue.issue_id %>"><i class="fas fa-search"></i></a>
									</td>
								</tr>
							<% }) %>
						<% } %>
					</tbody>
				</table>
			</div>
		</div>
		<div class="col-12 col-md-12 mx-auto bordered mb-2">
			<a class="my-3" data-toggle="collapse" href="#collapseReturn" role="button" aria-expanded="false" aria-controls="collapseReturn">
				<h4>Returns (<%= stock.returns_ls.length %>)</h4>
			</a>
			<div class="collapse mb-3" id="collapseReturn">
				<table class="table table-sm table-hover smallFont07 limit-height-200 w-100">
					<thead class="thead-dark">
						<th class="w-45" onclick="sortTable(0, 'returnTable')">Date</th>
						<th class="w-45" onclick="sortTable(1, 'returnTable')">From</th>
						<th class="w-10" onclick="sortTable(2, 'returnTable')">Qty</th>
						<th><i class="fas fa-search"></i></th>
					</thead>
					<tbody id="returnTable">
						<% if (stock.returns_ls && stock.returns_ls.length > 0) { %>
							<% stock.returns_ls.forEach(_return => { %>
								<tr>
									<td data-sort="<%= _return.return._date.getTime() %>">
										<a href="#"><%= _return.return._date.toDateString() %></a>
									</td>
									<td>
										<a href="#"><%= _return._from.user.rank._rank %> <%= _return._from.user._name %>, <%= _return._from.user._ini %></a>
									</td>
									<td>
										<a href="#"><%= _return._qty %></a>
									</td>
									<td>
										<a href="/stores/issues/<%= _return.return_id %>"><i class="fas fa-search"></i></a>
									</td>
								</tr>
							<% }) %>
						<% } %>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</section>
<% include ../../partials/foot/full %>
<script>
    function filterSelects() {
        filter(['system'],"/stores/stock/<%= stock.stock_id %>/edit");
    };
</script>
<% include ../../partials/foot/htmlClose %>