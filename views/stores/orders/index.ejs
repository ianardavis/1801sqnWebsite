<% include ../../partials/head/full %>
<section class='mb-2'>
	<nav class='navbar navbar-expand navbar-light bg-nav'>
		<ul class='navbar-nav mr-auto'>
			<li class='nav-item'>
				<a class='nav-link stores_nav' href='/stores'>
					Stores
				</a>
			</li>
			<li class='nav-item'>
				<a class='nav-link stores_nav' href='/stores/orders'>
					Orders
				</a>
			</li>
			<% if (permissions.order_add) { %>
				<li class='nav-item'>
					<a class='nav-link stores_nav cardGreen' href='/stores/orders/new?user=-1'>
						<i class='fas fa-plus'></i>
					</a>
				</li>
			<% } %>
		</ul>
	</nav>
</section>
<section class='container'>
	<form action='/stores/demands' method='POST'>
		<div class='row mb-2'>
			<div class='col-6'>
				<input class='btn btn-success w-100 confirm' type='submit' value='Raise Demands For:'>
			</div>
			<div class='col-6'>
				<select class='form-control' name='supplier_id' type='text'>
					<% suppliers.forEach(supplier => { %>
						<option value='<%= supplier.supplier_id %>'><%= supplier._name %></option>
					<% }); %>
				</select>
			</div>
		</div>
	</form>
	<div class='row mb-2'>
		<div class='col-3'>
			<label class='col-form-label' for='complete'>Completed Orders:</label>
		</div>
		<div class='col-9'>
			<select id='complete' class='form-control form-control-sm' type='text' onchange=filterSelects()>
				<option value='1'<% if (Number(query.complete) === 1) { %> selected <% } %>>Include</option>
				<option value='2'<% if (Number(query.complete) === 2) { %> selected <% } %>>Exclude</option>
				<option value='3'<% if (Number(query.complete) === 3) { %> selected <% } %>>Only</option>
			</select>
		</div>
	</div>
	<div class='row'>
		<div class='col-12'>
			<table class='table table-sm table-hover'>
				<thead class='thead-dark'>
					<th class='w-40' onclick='sortTable(0, "orderTable")'>Ordered For</th>
					<th class='w-40' onclick='sortTable(1, "orderTable")'>Order Date</th>
					<th class='w-10' onclick='sortTable(2, "orderTable")'>Lines</th>
					<th class='w-10'>Complete</th>
					<th><i class='fas fa-search'></i></th>
				</thead>
				<tbody id='orderTable'>
					<% if (orders) { %>
						<% orders.forEach(order => { %>
							<tr>
								<td>
									<% if (order.ordered_for !== -1) { %>
										<%= order._for.rank._rank %> <%= order._for._name %>, <%= order._for._ini %>
									<% } else { %>
										Backing Stock
									<% } %>
								</td>
								<td data-sort='<%= order._date.getTime() %>'>
									<%= order._date.toDateString() %>
								</td>
								<td>
									<%= order.lines.length %>
								</td>
								<td>
									<input class='form-control form-control-sm' type='checkbox' disabled <% if (order._complete) { %> checked <% } %>>
								</td>
								<td>
									<a class='btn btn-sm btn-primary' href='/stores/orders/<%= order.order_id %>'><i class='fas fa-search'></i></a>
								</td>
							</tr>
						<% }) %>
					<% } %>
				</tbody>
			</table>
		</div>
	</div>
</section>
<% include ../../partials/foot/full %>
<script src='/js/download.js'></script>
<script>
	<% if (download) { %>
		download_file('<%= download %>');
	<% } %>
    function filterSelects() {filter(['complete'], '/stores/orders');};
</script>
<% include ../../partials/foot/htmlClose %>