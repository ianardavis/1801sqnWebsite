<%- include(`${partials}/head/app`,   {text: 'Stores'}) %>
<%- include(`${partials}/breadcrumb`, {href: '/scraps', text: 'Scraps'}) %>
<%- include(`${partials}/breadcrumb`) %>
<%- include(`${partials}/reload`) %>
<%- include(`${partials}/head/components/close`) %>
<section class='container'>
	<%- include(`${partials}/sidebar_open`, {id: 'Actions', button_html: 'Actions', sidebar_text: 'Actions'}) %>
		<form id="form_scrap_complete">
			<button class='btn btn-success w-100' id='btn_scrap_complete'>
				Complete
			</button>
		</form>
		<form id="form_scrap_file_download">
			<button class='btn btn-success w-100' id='btn_scrap_file_download'>
				Download
			</button>
		</form>
		<form id="form_scrap_file_print">
			<button class='btn btn-primary w-100' id='btn_scrap_file_print'>
				Print
			</button>
		</form>
		<form id="form_scrap_file_delete">
			<button class='btn btn-danger w-100' id='btn_scrap_file_delete'>
				Delete
			</button>
		</form>
		<form id="form_delete" class="mt-auto">
			<button id='btn_delete' type='button' class="btn btn-danger w-100" disabled>
				Cancel
			</button>
		</form>
    <%- include(`${partials}/sidebar_close`) %>
	<ul class="nav nav-tabs" id="mainTab" role="tablist">
        <%- include(`${partials}/tab_head`, {id: 'details', title: 'Details', spinner: 'scrap'}) %>
        <%- include(`${partials}/tab_head`, {id: 'lines',   title: 'Lines',	  spinner: 'scrap_lines', count_id: 'line'}) %>
        <%- include(`${partials}/common/actions/tab_head`) %>
        <%- include(`${partials}/common/notes/tab_head`) %>
    </ul>
    <div class="tab-content pt-3" id="myTabContent">
        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
			<%- include(`${partials}/inputs/display`, {id: 'scrap_supplier',  title: 'Supplier', link: true}) %>
			<%- include(`${partials}/inputs/display`, {id: 'scrap_createdAt', title: 'Date'}) %>
			<%- include(`${partials}/inputs/display`, {id: 'scrap_updatedAt', title: 'Last Updated'}) %>
			<%- include(`${partials}/inputs/display`, {id: 'scrap_status', 	  title: 'Status'}) %>
			<div class="input-group mb-1">
				<span class="input-group-text w-30">Filename</span>
				<p class="form-control mb-0" id='scrap_filename'></p>
			</div>
		</div>
		<div class="tab-pane fade" id="lines" 	role="tabpanel" aria-labelledby="lines-tab">
			<%- include(`${partials}/inputs/select`, {title: 'Status', id: 'sel_status', options: [{value: '', text: 'All', selected: true}, {value: '"status":0', text: 'Cancelled'}, {value: '"status":1', text: 'Pending'}, {value: '"status":2', text: 'Open'}, {value: '"status":3', text: 'Returned'}]}) %>
			<% if (permissions.issuer) { %><form id='form_actions'><% } %>
			<%- include(`${partials}/button/button`, {id: 'lines_action', text: 'Action Lines', type: 'success', classes: ['mb-1', 'w-100']}) %>
			<%- include(`${partials}/sort`, {table: 'scrap_lines'}) %>
	        <table class='table table-sm table-hover'>
				<thead class='thead-dark'>
					<th class='w-35'>Item</th>
					<th class='w-35'>Size</th>
					<th class='w-10'>Qty</th>
					<th class='w-10'>Status</th>
					<th class='w-10'>Actions</th>
					<th><i class='fas fa-search'></i></th>
				</thead>
				<tbody id='tbl_lines'></tbody>
			</table>
			<%- include(`${partials}/limit`, {table: 'scrap_lines'}) %>
			<% if (permissions.issuer) { %></form><% } %>
		</div>
        <%- include(`${partials}/common/actions/tab_body`) %>
        <%- include(`${partials}/common/notes/tab_body`) %>
	</div>
	<div id="div_modals">
        <%- include(`${partials}/common/notes/modals`) %>
        <%- include(`${partials}/common/actions/modals`) %>
		<% if (permissions.stores_stock_admin) { %>
			<div id='mdl_scrap_complete' class="modal fade" tabindex="-1" role="dialog">
				<div class="modal-dialog modal-lg" role="document">
					<form id='form_complete' class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Complete Scrap Record</h5>
						</div>
						<div class="modal-body">
							<%- include(`${partials}/inputs/date`, {id: 'date_due_complete', title: 'Due Date', name: 'date_due'}) %>
						</div>
						<div class="modal-footer">
							<button class="btn btn-success w-100">Complete</button>
							<%- include(`${partials}/button/modal/close`) %>
						</div>
					</form>
				</div>
			</div>
		<% } %>
		<%- include(`${partials}/modals/stores/mdl_line_view`, {table: 'Scrap'}) %>
	</div>
</section>
<%- include(`${partials}/foot/app`) %>
<script src="/js/common/radios/nil_cancel.js"></script>
<script>show_tab('<%= tab %>')</script>
<%- include(`${partials}/common/notes/scripts`) %>
<%- include(`${partials}/common/actions/scripts`) %>

<script src="/js/stores/scraps/show/view.js"></script>
<script async>getScrap()</script>

<script src="/js/stores/scraps/show/lines/view.js"></script>
<script async>getLines()</script>
<% if (permissions.issuer) { %>
	<script src="/js/stores/scraps/show/edit.js"></script>
	<script src="/js/utils/list/stocks.js"></script>
	<script src="/js/utils/list/serials.js"></script>
	<script src="/js/stores/scrap_lines/edit.js"></script>
<% } %>
<%- include(`${partials}/foot/components/htmlClose`) %>