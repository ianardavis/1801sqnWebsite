<!-- ITEMS INDEX PAGE -->
<% include ../../partials/header %>
<% include ../../partials/nav %>
<% include ../../partials/bodyTop %>
<section class="container page_title">
	<div class="row">
		<div class="col-md-6 mx-auto">
			<a href="/stores"><h2>Stores Management</h2></a>
		</div>
	</div>
	<p class="text-left"><a href="/stores"> Main Menu </a>> > ><a href="/stores/items"> Items </a></p>
	<div class="row">
		<div class="col-2 mx-auto">
			<a href="/stores/items"><h3>Items</h3></a>
		</div>
	</div>
</section>
<% if (permissions.items_add) { %>
	<nav class="navbar navbar-expand navbar-dark bg-dark stores">
		<ul class="navbar-nav mr-auto">
			<li class="nav-item">
				<a class="nav-link" href="/stores/items/new">New Item</a>
			</li>
		</ul>
	</nav>
<% } %>
<div class="container mt-3 pt-3">
	<div>
		<label for="_category">Category:</label>
		<select id="_category" type="text">
			<option value="" data-tag='<blank>'></option>	
			<% classes.categories.forEach((cat) => { %>
				<option value="<%= cat.category_id %>"><%= cat._category %></option>
			<% }) %>
		</select>
		<label for="_group">Group:</label>
		<select id="_group" type="text">
			<option value="" data-tag='<blank>'></option>
			<% classes.groups.forEach((grp) => { %>
				<option value="<%= grp.group_id %>" data-tag='<%= grp._parent %>' style="display: none;"><%= grp._group %></option>
			<% }) %>
		</select>
		<label for="_type">Type:</label>
		<select id="_type" type="text"> 
			<option value="" data-tag='<blank>' ></option>	
			<% classes.types.forEach((typ) => { %>
				<option value="<%= typ.type_id %>" data-tag='<%= typ._parent %>' style="display: none;"><%= typ._type %></option>
			<% }) %>
		</select>
		<label for="_sub_type">Sub Type:</label>
		<select id="_sub_type" type="text">
			<option value="" data-tag='<blank>'></option>
			<% classes.subtypes.forEach((sub) => { %>
				<option value="<%= sub.subtype_id %>" data-tag='<%= sub._parent %>' style="display: none;"><%= sub._sub_type %></option>
			<% }) %>
		</select>
	</div>
	<div>
		<label for="_gender">Gender:</label>
		<select id="_gender" type="text">
			<option value="" data-tag='<blank>'></option>
			<% classes.genders.forEach((gen) => { %>
				<option value="<%= gen.gender_id %>"><%= gen._gender %></option>
			<% }) %>
		</select>
	</div>
	<form class="mb-3" action="/stores/items" method="GET">
		<input class="btn btn-warning" type="button" value="Filter Results" onclick="filter();">
	</form>
	<input class="form-control" type="text" id="itemSearch" onkeyup="searchTable('itemTable', 'itemSearch')" placeholder="Search for item..">
    <table id="itemTable" style="width:90%" class="mx-auto">
		<thead>
			<th style="width:60%">Description</th>
		</thead>
		<tbody>
			<% items.forEach((item) => { %>
				<tr>
					<td><a href="/stores/items/<%=item.item_id%>"> <%= item._description %></a></td>
				</tr>
			<% }) %>
		</tbody>
	</table>
</div>
<% include ../../partials/bodyBottom %>
<% include ../../partials/footer %>
<% include ../../partials/footjs %>
<script src="/js/tableSearch.js"></script>
<script src="/js/createClassQueryString.js"></script>
<!-- <script src="/js/filterClassSelects.js"></script> -->
<script>
$(window).on("load", () => {
    $('#_category').val(<%= query._category %>);
    setGroup;
    $('#_group').val(<%= query._group %>);
    setType;
    $('#_type').val(<%= query._type %>);
    setSubtype;
    $('#_sub_type').val(<%= query._sub_type %>);
    $('#_gender').val(<%= query._gender %>);
});
$('#_category').on('change', setGroup);	
$('#_group').on('change', setType);	
$('#_type').on('change', setSubtype);

function setGroup() {
    hideSome("_group", $(this).val());
    $("#_group").val($("#_group option:visible:first").val());
    $("#_type").val($("#_type option:visible:first").val());
    $("#_sub_type").val($("#_sub_type option:visible:first").val());
    hideAll("_type")
    hideAll("_sub_type")
}
function setType() {
    hideSome("_type", $(this).val());
    $("#_type").val($("#_type option:visible:first").val());
    $("#_sub_type").val($("#_sub_type option:visible:first").val());
    hideAll("_sub_type")
}
function setSubtype() {
    hideSome("_sub_type", $(this).val());
    $("#_sub_type").val($("#_sub_type option:visible:first").val());
}
function hideSome(select, selected) {
    $("#" + select + " option").each(function(item){
        var element =  $(this) ; 
        if (element.data("tag") != selected && element.data("tag") != '<blank>'){
            element.hide() ; 
        } else {
            element.show();
        }
    }) ; 
}
function hideAll(select) {
    $("#" + select + " option").each(function(item){
        var element =  $(this) ; 
        element.hide() ; 
    }) ; 
}</script>
<% include ../../partials/htmlBottom %>