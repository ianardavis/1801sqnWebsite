<!-- ITEMS EDIT PAGE -->
<% include ../../partials/head/full %>
<section class="mb-2">
    <nav class="navbar navbar-expand navbar-light bg-nav">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores">Stores</a>
            </li>
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores/items">Items</a>
            </li>
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores/items/<%= item.item_id %>"><%= item._description %></a>
            </li>
            <li class="nav-item">
                <a class="nav-link stores_nav" href="/stores/items/<%= item.item_id %>/edit">Edit</a>
            </li>
        </ul>
    </nav>
</section>
<section class="container-fluid p-5 w-50">
   <div class="details container bordered p-3">
        <form action="/stores/items/<%= item.item_id %>?_method=PUT" method="POST">
            <input type="hidden" name="failRedirect", value="/stores/items/<%= item.item_id %>" readonly>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Description:</label>
                </div>                        
                <div class="col-7">
                    <input class="form-control" type="text" name="item[_description]" value="<%= item._description %>">
                </div>
            </div>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Category:</label>
                </div> 
                <div class="col-7">
                    <select class="form-control" name="item[category_id]" id="_category" type="text">
                        <% classes.categories.forEach((category) => { %>
                            <% if (category.category_id === item._category) { %>
                                <option value="<%= category.category_id %>" selected><%= category._category %></option>
                            <% } else { %>
                                <option value="<%= category.category_id %>"><%= category._category %></option>
                            <% } %>
                        <% }) %>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Group:</label>
                </div> 
                <div class="col-7">
                    <select class="form-control" name="item[group_id]" id="_group" type="text">
                        <option value='' data-tag='<blank>'></option> 
                        <% classes.groups.forEach((group) => { %>
                            <% if (group.group_id === item._group) { %>
                                <option value="<%= group.group_id %>" data-tag='<%= group.category_id %>' selected><%= group._group %></option>
                            <% } else { %>
                                <option value="<%= group.group_id %>" data-tag='<%= group.category_id %>'><%= group._group %></option>
                            <% } %>
                        <% }) %>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Type:</label>
                </div> 
                <div class="col-7">
                    <select class="form-control" name="item[type_id]" id="_type" type="text">
                        <option value='' data-tag='<blank>'></option> 
                        <% classes.types.forEach((type) => { %>
                            <% if (type.type_id === item._type) { %>
                                <option value="<%= type.type_id %>" data-tag='<%= type.group_id %>' selected><%= type._type %></option>
                            <% } else { %>
                                <option value="<%= type.type_id %>" data-tag='<%= type.group_id %>'><%= type._type %></option>
                            <% } %>
                        <% }) %>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Sub Type:</label>
                </div> 
                <div class="col-7">
                    <select class="form-control" name="item[subtype_id]" id="_subtype" type="text">
                        <option value='' data-tag='<blank>'></option> 
                        <% classes.subtypes.forEach((subtype) => { %>
                            <% if (subtype.subtype_id === item._subtype) { %>
                                <option value="<%= subtype.subtype_id %>" data-tag='<%= subtype.type_id %>' selected><%= subtype._subtype %></option>         
                            <% } else { %>
                                <option value="<%= subtype.subtype_id %>" data-tag='<%= subtype.type_id %>'><%= subtype._subtype %></option>         
                            <% } %>
                        <% }) %>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Gender:</label>
                </div> 
                <div class="col-7">
                    <select class="form-control" name="item[gender_id]" id="_gender" type="text">
                        <option value='' data-tag='<blank>'></option> 
                        <% classes.genders.forEach((gender) => { %>
                            <% if (gender.gender_id === item._gender) { %>
                                <option value="<%= gender.gender_id %>" selected><%= gender._gender %></option>         
                            <% } else { %>
                                <option value="<%= gender.gender_id %>"><%= gender._gender %></option>         
                            <% } %>
                        <% }) %>
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <div class="col-5" >
                    <label class="col-form-label">Size Text:</label>
                </div>                        
                <div class="col-7">
                    <input class="form-control" type="text" name="item[_size_text]" value="<%= item._size_text %>" maxlength="45">
                </div>
            </div>
            <div class="form-group row p-3">
                <button class="btn btn-primary btn-lg col-12" type="submit" id="_submit">Save</button>
                <a href="/stores/items/<%= item.item_id %>">Cancel</a>
            </div>
        </form>
    </div>
</section>
<% include ../../partials/foot/full %>
<script>
	$('#_category').on('change', setGroup);	
	$('#_group').on('change', setType);	
	$('#_type').on('change', setSubtype);

	function setGroup() {
		hideSome("_group", $(this).val());
		$("#_group").val($("#_group option:visible:first").val());
		$("#_type").val($("#_type option:visible:first").val());
		$("#_subtype").val($("#_subtype option:visible:first").val());
		hideAll("_type")
		hideAll("_subtype")
	}
	function setType() {
		hideSome("_type", $(this).val());
		$("#_type").val($("#_type option:visible:first").val());
		$("#_subtype").val($("#_subtype option:visible:first").val());
		hideAll("_subtype")
	}
	function setSubtype() {
		hideSome("_subtype", $(this).val());
		$("#_subtype").val($("#_subtype option:visible:first").val());
	}
	function hideSome(select, selected) {
		$("#" + select + " option").each(function(item){
			var element =  $(this) ; 
			if (element.data("tag") != selected && element.data("tag") != '<blank>'){
				element.hide() ; 
			} else {
				element.show();
			}
		}) ; 
	}
	function hideAll(select) {
		$("#" + select + " option").each(function(item){
			var element =  $(this) ; 
			element.hide() ; 
		}) ; 
	}
</script>
<% include ../../partials/foot/htmlClose %>