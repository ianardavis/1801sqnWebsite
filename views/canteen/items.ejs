<% include ../partials/head/full %>
<section class='mb-2'>
    <nav class='navbar navbar-expand navbar-light bg-nav'>
        <ul class='navbar-nav mr-auto'>
            <li class='nav-item'>
                <a class='nav-link stores_nav' href='/canteen'>
                    Canteen
                </a>
            </li>
            <li class='nav-item'>
                <a class='nav-link stores_nav' href='/canteen/items'>
                    Items
                </a>
            </li>
        </ul>
    </nav>
</section>
<section class='container'>
    <div class="row">
        <% if (permissions.canteen_supervisor) { %>
            <div class="col-12 bordered mb-2">
                <form action="/canteen/items" method='POST'>
                    <div class="row">
                        <div class="col-6">
                            <label class='col-form-label'>Name</label>
                        </div>
                        <div class="col-6">
                            <input class='form-control' type="text" name='item[_name]' placeholder='Name' maxlength="45">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label class='col-form-label'>Cost</label>
                        </div>
                        <div class="col-6">
                            <input class='form-control' type="number" name='item[_cost]' step='0.01' placeholder='Cost'>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label class='col-form-label'>Price</label>
                        </div>
                        <div class="col-6">
                            <input class='form-control' type="number" name='item[_price]' step='0.01' placeholder='Price'>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label class='col-form-label'>Stock</label>
                        </div>
                        <div class="col-6">
                            <input class='form-control' type="number" name='item[_qty]' step='1' value='0' placeholder='Stock' maxlength="11">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <label class='col-form-label'>Current</label>
                        </div>
                        <div class="col-6">
                            <input class='form-control' type="checkbox" name='item[_current]' value='1' placeholder='Current'>
                        </div>
                    </div>
                    <button class='btn btn-success w-100 confirm'>Add Item</button>
                </form>
            </div>
        <% } %>
        <div class="col-12 bordered">
            <table class="table table-sm table-hover">
                <thead class="thead-dark">
                    <th class="w-20" onclick="sortTable(0, 'itemsTable')">Name</th>
                    <th class="w-20" onclick="sortTable(1, 'itemsTable')">Cost</th>
                    <th class="w-20" onclick="sortTable(2, 'itemsTable')">Price</th>
                    <th class="w-20" onclick="sortTable(3, 'itemsTable')">Stock</th>
                    <th class="w-20" onclick="sortTable(4, 'itemsTable')">Current</th>
                    <% if (permissions.canteen_supervisor) { %>
                        <th><i class='fas fa-save'></i></th>
                        <th><i class='fas fa-trash-alt'></i></th>
                    <% } %>
                </thead>
                <tbody id="itemsTable">
                    <% if (items) items.forEach(item => { %>
                        <tr>
                            <% if (permissions.canteen_supervisor) { %>
                                <form action="/canteen/items/<%= item.item_id %>?_method=PUT" method='POST'>
                                    <td>
                                        <input class='form-control form-control-sm' type="text" name='item[_name]' value='<%= item._name %>'>
                                    </td>
                                    <td>
                                        <input class='form-control form-control-sm' type="number" step='0.01' name='item[_cost]' value='<%= item._cost %>'>
                                    </td>
                                    <td>
                                        <input class='form-control form-control-sm' type="number" step='0.01' name='item[_price]' value='<%= item._price %>'>
                                    </td>
                                    <td>
                                        <input class='form-control form-control-sm' type="number" step='1' name='item[_qty]' value='<%= item._qty %>'>
                                    </td>
                                    <td>
                                        <select class='form-control form-control-sm' name="item[_current]">
                                            <option value="1" <% if (item._current) { %> selected <% } %>>Yes</option>
                                            <option value="0" <% if (!item._current) { %> selected <% } %>>No</option>
                                        </select>
                                    </td>
                                    <td>
                                        <button class='btn btn-sm btn-success confirm'><i class='fas fa-save'></i></button>
                                    </td>
                                </form>
                                <td>
                                    <form action="/canteen/items/<%= item.item_id %>?_method=DELETE" method='POST'>
                                        <button class='btn btn-sm btn-danger confirm'><i class='fas fa-trash-alt'></i></button>
                                    </form>
                                </td>
                            <% } else { %>
                                <td><%= item._name %></td>
                                <td>£<%= item._cost %></td>
                                <td>£<%= item._price %></td>
                                <td><%= item._qty %></td>
                                <td>
                                    <input class='form-control form-control-sm' type="checkbox" <% if (item._current) { %> checked <% } %> disabled>
                                </td>
                            <% } %>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</section>
<% include ../partials/foot/full %>
<% include ../partials/foot/htmlClose %>