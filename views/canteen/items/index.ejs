<%- include(`${partials}/head/full`) %>
<section class='mb-2'>
    <nav class='navbar navbar-expand navbar-light bg-nav'>
        <ul class='navbar-nav mr-auto'>
            <%- include(`${partials}/breadcrumb`, {href: '/canteen',	   text: 'Canteen'}) %>
            <%- include(`${partials}/breadcrumb`, {href: '/canteen/items', text: 'Items'}) %>
			<% if (permissions.item_add) { %>
				<%- include(`${partials}/breadcrumb`, {html: '<i class="fas fa-plus"></i>', href: 'javascript:$("#mdl_add_item").modal("show")'}) %>
			<% } %>
            <%- include(`${partials}/reload`) %>
            <%- include(`${partials}/spinner`, {id: 'items'}) %>
        </ul>
    </nav>
</section>
<section class='container'>
    <%- include(`${partials}/inputs/select`, {title: 'Non-Current Items', id: '_current', spinner: true, spinner_sm: true, spinner_float_right: true, options: [{value:'', text: 'Include', selected: true},{value:'_current=1', text: 'Exclude'},{value:'_current=0', text: 'Only'}]}) %>
	<table class="table table-sm table-hover">
        <thead class="thead-dark">
            <th class="w-30" onclick="sortTable(0, 'tbl_items')">Name</th>
            <th class="w-30" onclick="sortTable(1, 'tbl_items')">Price</th>
            <th class="w-30" onclick="sortTable(2, 'tbl_items')">Stock</th>
            <th class="w-10" onclick="sortTable(3, 'tbl_items')">Current</th>
            <th><i class='fas fa-search'></i></th>
        </thead>
        <tbody id="tbl_items">
        </tbody>
    </table>
    <% if (permissions.item_add) { %>
        <div id='mdl_add_item' class="modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <form class="modal-content" id='form_add_item'>
                    <div class="modal-header">
                        <h5 class="modal-title">Add Item</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <%- include(`${partials}/inputs/text`,   {title: 'Name',    name: 'item[_name]',    required: true, maxLength: '45'}) %>
                        <%- include(`${partials}/inputs/number`, {title: 'Price',   name: 'item[_price]',   required: true, value: '0.50', step: '0.01', min: '0'}) %>
                        <%- include(`${partials}/inputs/number`, {title: 'Cost',    name: 'item[_cost]',    required: true, value: '0.00', step: '0.01', min: '0'}) %>
                        <%- include(`${partials}/inputs/number`, {title: 'Stock',   name: 'item[_qty]',     required: true, value: '0',                  min: '0'}) %>
                        <%- include(`${partials}/inputs/select`, {title: 'Current', name: 'item[_current]', options: [{value: '1', text: 'Yes', selected: true}, {value: '0', text: 'No'}]}) %>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" class="btn btn-success w-100 confirm" value='Save Item'>
                    </div>
                </form>
            </div>
        </div>
    <% } %>
</section>
<%- include(`${partials}/foot/full`) %>
<script src="/js/canteen/items/index/getItems.js"></script>
<script src="/js/data/addFormListener.js"></script>
<script src="/js/data/send.js"></script>
<script async>getItems()</script>
<% if (permissions.item_add) { %>
<script>
    window.addEventListener('load', function () {
        addFormListener(
            'form_add_item',
            'POST',
            '/canteen/items',
            {
                onComplete: [
                    window.getItems,
                    function () {$('#mdl_add_item').modal('hide')}
                ]
            }
        )
    })
</script>
<% } %>
<%- include(`${partials}/foot/htmlClose`) %>